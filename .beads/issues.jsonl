{"id":"locdoc-06y","title":"Remove unused RAG interfaces (ChunkService, SearchService)","description":"## Problem\n\nWe decided not to implement RAG initially, so the ChunkService and SearchService interfaces are unused and should be removed to reduce codebase complexity.\n\n## Entrypoints\n\n- `chunk.go` - contains all the types to remove\n\n## Work Required\n\nRemove the following from `chunk.go`:\n- `Chunk` struct\n- `ChunkMetadata` struct\n- `Chunk.Validate()` method\n- `ChunkService` interface\n- `ChunkFilter` struct\n- `SearchService` interface\n- `SearchOptions` struct\n- `SearchResult` struct\n\nIf the file becomes empty after removal, delete it entirely.\n\nAlso check `mock/` for any related mocks and remove them.\n\n## Validation\n\n- [ ] All RAG-related types removed from chunk.go\n- [ ] No orphaned mocks remain\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T20:16:34.374725-08:00","updated_at":"2025-12-09T20:23:38.153302-08:00","closed_at":"2025-12-09T20:23:38.153305-08:00"}
{"id":"locdoc-0fo","title":"Verify golangci-lint configuration alignment","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.010199-08:00","updated_at":"2025-12-07T17:52:59.10034-08:00","closed_at":"2025-12-07T17:52:59.100343-08:00","dependencies":[{"issue_id":"locdoc-0fo","depends_on_id":"locdoc-hw3","type":"blocks","created_at":"2025-12-07T16:40:55.276865-08:00","created_by":"daemon"}]}
{"id":"locdoc-0kg","title":"Filter sitemap URLs by source URL path prefix","description":"## Problem\n\nWhen adding a project with a path-specific URL like `https://htmx.org/docs/`, the sitemap discovery returns URLs for the entire site. This results in crawling unrelated pages (e.g., `/examples/`, `/essays/`) when the user only wanted `/docs/`.\n\n## Entrypoints\n\n- `http/sitemap.go` (SitemapService.DiscoverURLs)\n- `locdoc.go` (URLFilter struct)\n\n## Implementation\n\nWhen the source URL has a non-root path (e.g., `/docs/`), automatically filter sitemap results to only include URLs that start with that path prefix.\n\nExamples:\n- Source: `https://htmx.org/docs/` → only crawl URLs starting with `/docs/`\n- Source: `https://htmx.org/` → crawl all URLs (no filtering)\n- Source: `https://example.com/api/v2/` → only crawl URLs starting with `/api/v2/`\n\n## Validation\n\n- [ ] `locdoc add foo https://htmx.org/docs/` followed by `locdoc crawl foo` only fetches `/docs/*` pages\n- [ ] `locdoc add bar https://htmx.org/` crawls all pages (no filtering)\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:43:17.869922-08:00","updated_at":"2025-12-10T08:46:37.440774-08:00","closed_at":"2025-12-10T08:46:37.440777-08:00"}
{"id":"locdoc-1h6","title":"Create domain types skeleton","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:32.199767-08:00","updated_at":"2025-12-07T16:56:36.84987-08:00","closed_at":"2025-12-07T16:56:36.849873-08:00","dependencies":[{"issue_id":"locdoc-1h6","depends_on_id":"locdoc-knx","type":"blocks","created_at":"2025-12-07T16:40:59.902041-08:00","created_by":"daemon"}]}
{"id":"locdoc-1z8","title":"Create GitHub Actions CI workflow","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.10089-08:00","updated_at":"2025-12-07T18:08:02.712841-08:00","closed_at":"2025-12-07T18:08:02.712844-08:00","dependencies":[{"issue_id":"locdoc-1z8","depends_on_id":"locdoc-knx","type":"blocks","created_at":"2025-12-07T16:40:59.837864-08:00","created_by":"daemon"},{"issue_id":"locdoc-1z8","depends_on_id":"locdoc-0fo","type":"blocks","created_at":"2025-12-07T16:40:59.962233-08:00","created_by":"daemon"}]}
{"id":"locdoc-296","title":"Add Position field to Document domain type","description":"## Problem\n\nDocuments need a Position field to preserve sitemap order for coherent LLM context.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/document.go`\n\n## Implementation\n\nAdd `Position int` to `Document` struct (after ContentHash, before FetchedAt):\n```go\nPosition int `json:\"position\"`\n```\n\nAdd `Position *int` to `DocumentUpdate`:\n```go\nPosition *int `json:\"position\"`\n```\n\nAdd `SortBy string` to `DocumentFilter`:\n```go\nSortBy string `json:\"sortBy\"` // \"position\" or \"fetched_at\"\n```\n\n## Validation\n\n- [ ] Types compile\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:02.201376-08:00","updated_at":"2025-12-09T18:55:31.409109-08:00","closed_at":"2025-12-09T18:55:31.409112-08:00"}
{"id":"locdoc-2pt","title":"Add --concurrency flag to locdoc add command","description":"## Problem\nConcurrency is hardcoded at 20, not tunable for different machines or sites.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - `ParseAddArgs()` and `crawlProject()`\n\n## Validation\n- [ ] `--concurrency N` / `-c N` flag added to `locdoc add`\n- [ ] Default is 10 (documented in help text)\n- [ ] Flag value used instead of hardcoded 20\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T15:41:12.141973-08:00","updated_at":"2025-12-10T17:47:09.136086-08:00","closed_at":"2025-12-10T17:47:09.136088-08:00"}
{"id":"locdoc-2yj","title":"Support crawling sites without sitemap.xml","description":"Implement recursive link crawling with navigation-aware extraction as fallback when sitemap discovery fails.\n\n## Design Decisions\n- Trigger: Fallback only (sitemap first, recursive if 0 URLs)\n- Persistence: None (in-memory frontier)\n- Scope: Path prefix limiting\n- Frameworks: Full support + generic fallback\n\nSee plan: ~/.claude/plans/recursive-spinning-milner.md","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-18T16:07:18.827188-08:00","updated_at":"2025-12-18T16:07:18.827188-08:00"}
{"id":"locdoc-2zl","title":"Integrate crawl logic into add command","description":"Move crawl functionality into the add command so add creates project AND crawls in one step.\n\n## Behavior\n- add \u003cname\u003e \u003curl\u003e creates project then immediately crawls\n- Remove hash-based diffing logic (always fresh crawl)\n- Errors if project already exists (without --force)\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd, crawlProject)\n\n## Validation\n- [ ] locdoc add \u003cname\u003e \u003curl\u003e creates and crawls\n- [ ] Error if project exists\n- [ ] No diffing logic (simpler code)\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:23.718095-08:00","updated_at":"2025-12-10T12:58:34.149813-08:00","closed_at":"2025-12-10T12:58:34.149817-08:00","dependencies":[{"issue_id":"locdoc-2zl","depends_on_id":"locdoc-612","type":"blocks","created_at":"2025-12-10T11:06:44.505494-08:00","created_by":"daemon"}]}
{"id":"locdoc-3if","title":"Restore live progress display for add command","description":"## Problem\nThe add command lost its live progress display during the CLI refactor to Kong. Currently, the progress callback in `cmd/locdoc/add.go` only reports:\n- Initial URL count (ProgressStarted)\n- Failed URLs (ProgressFailed)\n\nIt ignores ProgressCompleted and ProgressFinished events, so users don't see live progress during crawling.\n\n## Entrypoints\n- `cmd/locdoc/add.go:81-90` - progress callback that needs enhancement\n- `crawl/crawl.go:39-59` - ProgressEvent types (infrastructure is ready)\n- Git history: commits 97af7c9 and a3217d6 had live progress with `\\r` updates\n\n## Validation\n- [ ] Progress line updates in-place during crawl showing `[N/M]` completion\n- [ ] Failed URLs still print on separate lines\n- [ ] Final summary shows totals\n- [ ] `make validate` passes","notes":"COMPLETED: Implemented live progress display\n- Progress callback now handles ProgressCompleted events\n- Shows [N/M] format with carriage return for in-place updates\n- Failed URLs print on separate lines (persists in scroll history)\n- Progress line cleared on ProgressFinished\n- Tests added and passing\n- make validate passes\n\nREADY FOR: /finish-task","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T11:16:34.17704-08:00","updated_at":"2025-12-12T11:24:55.250771-08:00","closed_at":"2025-12-12T11:24:55.250774-08:00"}
{"id":"locdoc-4jw","title":"Implement documentation framework detector","description":"Create FrameworkDetector that identifies doc frameworks (Docusaurus, MkDocs, Sphinx, etc.) from HTML.\n\n## Entrypoints\n- Create goquery/detector.go - Detector struct checking framework-specific markers\n- Create goquery/detector_test.go with HTML samples from each framework\n\n## Validation\n- Correctly identifies all 6 supported frameworks\n- Returns FrameworkUnknown for unrecognized HTML\n- make validate passes","notes":"COMPLETED: FrameworkDetector with research-validated markers\n\nSupports all 7 frameworks defined in linkselector.go:\n- Docusaurus, MkDocs, Sphinx, VitePress, VuePress, GitBook, Nextra\n\nDetection methods (in priority order):\n1. Meta generator tag (most reliable for Sphinx, GitBook)\n2. Framework-specific CSS classes and data attributes\n\nTests: 21 test cases covering all frameworks + priority order + edge cases\nDetector is stateless and safe for concurrent use.\nmake validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:52.882025-08:00","updated_at":"2025-12-18T18:11:24.559617-08:00","closed_at":"2025-12-18T18:11:24.55962-08:00","dependencies":[{"issue_id":"locdoc-4jw","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.671053-08:00","created_by":"daemon"},{"issue_id":"locdoc-4jw","depends_on_id":"locdoc-phn","type":"blocks","created_at":"2025-12-18T16:18:20.027333-08:00","created_by":"daemon"}]}
{"id":"locdoc-4nk","title":"Implement gemini/ package","description":"## Problem\n\nNeed to implement the `Asker` interface using Google Gemini API.\n\n## Entrypoints\n\n- Create `gemini/gemini.go`\n\n## Implementation\n\n- Use `google.golang.org/genai` client\n- Read API key from `GEMINI_API_KEY` env var\n- Construct prompt from documents + question\n- Use `gemini-2.0-flash` model\n- Return plain text answer\n\n## Prompt Template\n\n```\nYou are a helpful assistant answering questions about software library documentation.\n\n\u003cdocumentation\u003e\n## Document: {title or source URL}\n{content}\n...\n\u003c/documentation\u003e\n\nQuestion: {question}\n\nAnswer based only on the documentation provided. If the answer is not in the documentation, say so.\n```\n\n## Validation\n\n- [ ] Package compiles\n- [ ] Mock added to `mock/` package\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:52.543185-08:00","updated_at":"2025-12-09T20:55:10.347225-08:00","closed_at":"2025-12-09T20:55:10.347229-08:00","dependencies":[{"issue_id":"locdoc-4nk","depends_on_id":"locdoc-amg","type":"blocks","created_at":"2025-12-09T16:29:04.564441-08:00","created_by":"daemon"}]}
{"id":"locdoc-4qp","title":"Update SQLite schema and implementation for Position","description":"## Problem\n\nSQLite needs position column and queries need to handle it.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/sqlite/sqlite.go` - schema\n- `/Users/filip/code/go/locdoc/sqlite/document.go` - queries\n\n## Implementation\n\n**Schema** - add column to documents table:\n```sql\nposition INTEGER NOT NULL DEFAULT 0\n```\n\n**CreateDocument** - include position in INSERT\n\n**FindDocumentByID** - include position in SELECT and Scan\n\n**FindDocuments** - include position in SELECT/Scan, respect SortBy:\n```go\nswitch filter.SortBy {\ncase \"position\":\n    query.WriteString(\" ORDER BY position ASC\")\ndefault:\n    query.WriteString(\" ORDER BY fetched_at DESC\")\n}\n```\n\n**UpdateDocument** - handle Position in update\n\n## Validation\n\n- [ ] Schema includes position column\n- [ ] All queries handle position\n- [ ] SortBy respected in FindDocuments\n- [ ] Existing tests pass\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:08.935564-08:00","updated_at":"2025-12-09T19:01:18.324679-08:00","closed_at":"2025-12-09T19:01:18.324681-08:00","dependencies":[{"issue_id":"locdoc-4qp","depends_on_id":"locdoc-296","type":"blocks","created_at":"2025-12-09T17:57:42.54959-08:00","created_by":"daemon"}]}
{"id":"locdoc-4se","title":"Update ask command design document for ordering","description":"## Problem\n\nThe ask command design document should mention document ordering.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/docs/plans/2025-12-09-ask-command-design.md`\n\n## Changes\n\nUpdate the design doc to note:\n- Documents are fetched in sitemap position order\n- This provides coherent LLM context (getting started before advanced topics)\n- Use `SortBy: \"position\"` when fetching documents for ask command\n\n## Validation\n\n- [ ] Design doc updated\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:32.523577-08:00","updated_at":"2025-12-09T18:52:24.414431-08:00","closed_at":"2025-12-09T18:52:24.414434-08:00"}
{"id":"locdoc-56t","title":"Add locdoc delete command","description":"## Problem\n\nNeed CLI command to delete projects.\n\n## Entrypoints\n\n- `cmd/locdoc/main.go` - Add delete command dispatch\n- Interface and sqlite implementation already exist (`ProjectService.DeleteProject`)\n\n## Requirements\n\n- `locdoc delete \u003cname\u003e` - delete project by name\n- Confirm before deleting (or add --force flag)\n- Cascade deletes associated documents (handled by sqlite foreign keys)\n\n## Validation\n\n- [ ] Unit tests for cmdDelete\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T14:25:01.662287-08:00","updated_at":"2025-12-09T15:05:18.77442-08:00","closed_at":"2025-12-09T15:05:18.774424-08:00"}
{"id":"locdoc-57u","title":"Add explicit fetch timeout to page navigation","description":"## Problem\nPage fetching relies on Rod's default timeout, giving no explicit control over how long to wait for slow pages.\n\n## Entrypoints\n- `rod/fetcher.go` - Fetcher implementation\n\n## Validation\n- [ ] Page navigation uses explicit 30-second timeout\n- [ ] Timeout errors surface clearly in fetch failures\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T15:41:02.475682-08:00","updated_at":"2025-12-10T16:46:51.023551-08:00","closed_at":"2025-12-10T16:46:51.023554-08:00"}
{"id":"locdoc-5kd","title":"Integrate recursive crawling into Crawler","description":"Modify crawl.Crawler to use recursive crawling as fallback when sitemap returns 0 URLs. Includes per-domain rate limiting.\n\n## Entrypoints\n- Create crawl/ratelimit.go - DomainLimiter using x/time/rate\n- Create crawl/ratelimit_test.go\n- Modify crawl/crawl.go:\n  - Add LinkSelectors and RateLimiter fields\n  - Add recursiveCrawl() method\n  - Modify CrawlProject() to fall back to recursive crawl\n- Update crawl/crawl_test.go\n\n## Validation\n- Rate limiter blocks when limit exceeded\n- Different domains have independent limits\n- Sitemap discovery still works (existing tests pass)\n- Falls back to recursive when sitemap returns 0 URLs\n- Respects path prefix scope\n- make validate passes","notes":"COMPLETED: All implementation\n- DomainLimiter with per-domain rate limiting using x/time/rate\n- Crawler struct extended with LinkSelectors and RateLimiter fields  \n- recursiveCrawl method implementing BFS with frontier and dedup\n- CrawlProject falls back to recursive crawl when sitemap returns 0 URLs\n- Path prefix scoping to limit crawl to source URL path\n- Tests for rate limiting, path scoping, fallback behavior\n- make validate passes\n\nREADY FOR: /finish-task","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T16:08:11.001765-08:00","updated_at":"2025-12-18T19:23:27.898338-08:00","dependencies":[{"issue_id":"locdoc-5kd","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.980475-08:00","created_by":"daemon"},{"issue_id":"locdoc-5kd","depends_on_id":"locdoc-ys8","type":"blocks","created_at":"2025-12-18T16:18:25.130699-08:00","created_by":"daemon"},{"issue_id":"locdoc-5kd","depends_on_id":"locdoc-lf5","type":"blocks","created_at":"2025-12-18T16:18:25.188686-08:00","created_by":"daemon"},{"issue_id":"locdoc-5kd","depends_on_id":"locdoc-l3o","type":"blocks","created_at":"2025-12-18T16:18:25.250847-08:00","created_by":"daemon"}]}
{"id":"locdoc-5lp","title":"Implement framework-specific link selectors","description":"Create selectors for Docusaurus, MkDocs, Sphinx, VuePress/VitePress, GitBook, and Nextra.\n\n## Entrypoints\n- Create goquery/selector_docusaurus.go\n- Create goquery/selector_mkdocs.go\n- Create goquery/selector_sphinx.go\n- Create goquery/selector_vuepress.go (covers VitePress)\n- Create goquery/selector_gitbook.go\n- Create goquery/selector_nextra.go\n- Tests for each\n\n## Validation\n- Each selector extracts correct navigation links from framework HTML\n- make validate passes","notes":"COMPLETED: All 6 framework-specific link selectors implemented\n\nCreated:\n- goquery/selector_docusaurus.go (+ test)\n- goquery/selector_mkdocs.go (+ test)  \n- goquery/selector_sphinx.go (+ test)\n- goquery/selector_vuepress.go (+ test) - covers VitePress too\n- goquery/selector_gitbook.go (+ test)\n- goquery/selector_nextra.go (+ test)\n\nEach selector:\n- Implements locdoc.LinkSelector interface\n- Extracts links from framework-specific HTML elements\n- Assigns correct priorities (TOC \u003e Navigation \u003e Content \u003e Footer)\n- Filters external links\n- Deduplicates keeping highest priority\n\nAll tests pass, make validate passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:53.09838-08:00","updated_at":"2025-12-18T18:45:35.555877-08:00","closed_at":"2025-12-18T18:45:35.55588-08:00","dependencies":[{"issue_id":"locdoc-5lp","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.736736-08:00","created_by":"daemon"},{"issue_id":"locdoc-5lp","depends_on_id":"locdoc-nwx","type":"blocks","created_at":"2025-12-18T16:18:22.686022-08:00","created_by":"daemon"},{"issue_id":"locdoc-5lp","depends_on_id":"locdoc-4jw","type":"blocks","created_at":"2025-12-18T16:18:22.746274-08:00","created_by":"daemon"}]}
{"id":"locdoc-5ma","title":"Add bounded concurrency to crawl command","description":"## Problem\n\nCrawling is slow because URLs are fetched sequentially. With 179 URLs, this takes several minutes.\n\n## Entrypoints\n\n- cmd/locdoc/main.go (crawlProject function)\n\n## Implementation\n\nAdd bounded concurrency (e.g., 5-10 workers) while preserving document position ordering:\n1. Create a worker pool with semaphore\n2. Process URLs concurrently\n3. Collect results with their original position index\n4. Store documents with correct position values\n\nConsider using errgroup with SetLimit() for bounded concurrency.\n\n## Validation\n\n- [ ] Crawl is noticeably faster\n- [ ] Document positions are preserved correctly\n- [ ] Error handling still works (skip failed URLs)\n- [ ] make validate passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T20:57:11.594455-08:00","updated_at":"2025-12-09T21:30:15.160985-08:00","closed_at":"2025-12-09T21:30:15.160989-08:00"}
{"id":"locdoc-612","title":"Add --preview flag to add command","description":"Add --preview flag that shows sitemap URLs without creating project or crawling.\n\n## Behavior\n- Discovers URLs from sitemap\n- Prints URL list to stdout\n- Does NOT create project record\n- Does NOT crawl\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n\n## Validation\n- [ ] locdoc add foo http://example.com --preview shows URLs\n- [ ] No project created with --preview\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:11.515317-08:00","updated_at":"2025-12-10T12:15:44.829601-08:00","closed_at":"2025-12-10T12:15:44.829605-08:00"}
{"id":"locdoc-63p","title":"Implement AddCmd with Kong","description":"Create cmd/locdoc/add.go with AddCmd struct and Run method. Wire to use crawl.Crawler for crawling. Handle --preview mode (sitemap discovery only). Handle --force mode (delete existing). Progress callback writes to stdout/stderr.","acceptance_criteria":"- [ ] cmd/locdoc/add.go exists\n- [ ] AddCmd struct with all flags (Name, URL, Preview, Force, Filter, Concurrency)\n- [ ] Run method delegates to Crawler.CrawlProject\n- [ ] Preview mode works (shows URLs without crawling)\n- [ ] Force mode works (deletes existing project first)\n- [ ] cmd/locdoc/add_test.go with integration tests\n- [ ] make validate passes","notes":"COMPLETED: AddCmd implementation with TDD\n- cmd/locdoc/add.go: Run method delegates to Crawler.CrawlProject\n- cmd/locdoc/add_test.go: 5 tests covering basic crawl, preview, force, filter validation\n- Preview mode shows URLs without creating project\n- Force mode deletes existing project first\n- Filter patterns validated early and stored in project\n- make validate passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:45:10.142185-08:00","updated_at":"2025-12-11T19:33:21.770034-08:00","closed_at":"2025-12-11T19:33:21.770037-08:00","dependencies":[{"issue_id":"locdoc-63p","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.287673-08:00","created_by":"daemon"},{"issue_id":"locdoc-63p","depends_on_id":"locdoc-8cu","type":"blocks","created_at":"2025-12-11T17:48:03.945623-08:00","created_by":"daemon"},{"issue_id":"locdoc-63p","depends_on_id":"locdoc-t0c","type":"blocks","created_at":"2025-12-11T17:48:04.06887-08:00","created_by":"daemon"}]}
{"id":"locdoc-6ph","title":"Expand docs/ with workflow documentation","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.388874-08:00","updated_at":"2025-12-07T20:25:33.186919-08:00","closed_at":"2025-12-07T20:25:33.186923-08:00","dependencies":[{"issue_id":"locdoc-6ph","depends_on_id":"locdoc-hw3","type":"blocks","created_at":"2025-12-07T16:40:59.769594-08:00","created_by":"daemon"}]}
{"id":"locdoc-726","title":"Epic: Combine add and crawl commands","description":"Merge the two-step add/crawl flow into a single add command. Remove diffing logic in favor of simpler delete + recreate pattern. Add --force, --preview, and --filter flags.\n\nDesign doc: docs/plans/2025-12-10-combine-add-crawl-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:05:47.835912-08:00","updated_at":"2025-12-10T14:28:15.629078-08:00","closed_at":"2025-12-10T14:28:15.629081-08:00"}
{"id":"locdoc-76q","title":"Upgrade to Gemini 3 Flash","description":"## Problem\nGoogle released Gemini 3 Flash on Dec 17, 2025. It's faster and more capable than 2.5 Flash, with better agentic coding performance (78% on SWE-bench).\n\n## Changes\n- Update model constant from `gemini-2.5-flash` to `gemini-3-flash-preview`\n- Update README.md to reflect the new model\n\n## Entrypoints\n- `gemini/asker.go:12` - model constant\n- `cmd/locdoc/main.go:163` - defaultTokenizerModel constant\n- `README.md` - mentions \"Gemini 2.5 Flash\"\n\n## Validation\n- [ ] `locdoc ask` works with new model\n- [ ] README reflects Gemini 3 Flash\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:08:32.923093-08:00","updated_at":"2025-12-17T12:15:20.981192-08:00","closed_at":"2025-12-17T12:15:20.981195-08:00"}
{"id":"locdoc-7n8","title":"Improve beads metadata workflow to avoid mixing with feature PRs","description":"## Problem\nWhen using `bd update` to mark tasks closed, the `.beads/issues.jsonl` change ends up in the working tree and can accidentally get included in feature PR commits. This causes PR review tools (like GitHub Copilot) to flag unintended changes.\n\n## Potential solutions\n- Commit beads changes separately before the feature commit\n- Add `.gitattributes` to mark `.beads/` as not needing review\n- Script the \"land this plane\" flow to handle beads commits first\n- Investigate if beads protected_branches config can help more","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:15:48.914404-08:00","updated_at":"2025-12-07T19:55:47.046488-08:00","closed_at":"2025-12-07T19:55:47.04649-08:00"}
{"id":"locdoc-7uh","title":"Delete obsolete tests and verify test reduction","description":"Delete tests for ParseAddArgs (Kong handles this). Delete tests that only verify argument parsing. Keep integration tests that verify end-to-end behavior. Verify total test line count is reduced by ~80%.","acceptance_criteria":"- [ ] ParseAddArgs tests deleted\n- [ ] Arg parsing edge case tests deleted\n- [ ] Integration tests remain and pass\n- [ ] Test line count reduced from ~1800 to ~300-400\n- [ ] make validate passes","notes":"COMPLETED: Deleted redundant tests (error path tests) from all command test files\nRESULT: Test lines reduced from ~1800 to 608 (66% reduction)\nKEPT: Essential integration tests - happy paths and distinct behaviors\nRATIONALE: 300-400 target would require removing tests for legitimate functionality","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:49.35442-08:00","updated_at":"2025-12-11T20:51:39.934423-08:00","closed_at":"2025-12-11T20:51:39.934425-08:00","dependencies":[{"issue_id":"locdoc-7uh","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.453501-08:00","created_by":"daemon"},{"issue_id":"locdoc-7uh","depends_on_id":"locdoc-c1n","type":"blocks","created_at":"2025-12-11T17:48:04.23113-08:00","created_by":"daemon"}]}
{"id":"locdoc-7x3","title":"Consider SQLite WAL mode for write-heavy operations","description":"## Problem\n\nSQLite WAL (Write-Ahead Logging) mode can improve performance for write-heavy operations like crawling. Currently using default rollback journal.\n\n## Entrypoints\n\n- `sqlite/sqlite.go` - `Open()` method\n\n## Analysis Needed\n\n- Benchmark crawl performance with/without WAL\n- Consider trade-offs:\n  - WAL creates extra files (`-wal`, `-shm`) alongside database\n  - Better for concurrent access (less relevant for CLI)\n  - Better crash recovery\n  - Files must be checkpointed before moving database\n\n## References\n\n- https://github.com/benbjohnson/wtf/blob/main/sqlite/sqlite.go\n- https://sqlite.org/wal.html\n\n## Validation\n\n- [ ] Benchmark shows measurable improvement\n- [ ] Document decision either way","notes":"Implemented WAL mode. Benchmarks showed ~7x improvement for single inserts (51µs vs 344µs) and ~6.7x for bulk inserts (4.4ms vs 29ms for 100 docs). Also reduced memory allocations by ~20x per operation.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T13:20:05.747214-08:00","updated_at":"2025-12-09T19:23:57.450621-08:00","closed_at":"2025-12-09T19:23:57.450626-08:00"}
{"id":"locdoc-8cu","title":"Wire Dependencies struct and Kong binding","description":"Create Dependencies struct in main.go. Wire Kong to bind Dependencies to command Run methods. Initialize all services in Main.Run() and pass to parser. Update Main struct as needed.","acceptance_criteria":"- [ ] Dependencies struct with all fields (Ctx, Stdout, Stderr, DB, Projects, Documents, Sitemaps, Crawler, Asker)\n- [ ] Kong parser configured with kong.Bind(\u0026deps)\n- [ ] Services initialized before parsing\n- [ ] All commands receive Dependencies in Run method\n- [ ] make validate passes","notes":"COMPLETED: Wire Dependencies struct and Kong binding\n- Created Dependencies struct in cli.go with all fields (Ctx, Stdout, Stderr, DB, Projects, Documents, Sitemaps, Crawler, Asker)\n- Updated all command Run methods to accept *Dependencies parameter\n- Configured Kong parser with kong.Bind(deps) in Main.Run()\n- Initialize deps before parsing, populate with services after DB opens\n- Removed structural tests (reflection-based) that don't test behavior\n- Manual dispatch preserved until subsequent tasks implement Run methods\n- make validate passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:45:36.638079-08:00","updated_at":"2025-12-11T18:31:44.731014-08:00","closed_at":"2025-12-11T18:31:44.731017-08:00","dependencies":[{"issue_id":"locdoc-8cu","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.404062-08:00","created_by":"daemon"},{"issue_id":"locdoc-8cu","depends_on_id":"locdoc-nle","type":"blocks","created_at":"2025-12-11T17:48:03.817055-08:00","created_by":"daemon"}]}
{"id":"locdoc-8pb","title":"Implement Bloom filter for URL deduplication","description":"Create bloom/ package wrapping github.com/bits-and-blooms/bloom/v3 for memory-efficient URL deduplication.\n\n## Entrypoints\n- Create bloom/filter.go - Filter struct with Add(), Test(), EstimatedCount()\n- Create bloom/filter_test.go\n\n## Validation\n- Filter correctly detects seen URLs\n- False positive rate ~1% at 10k URLs\n- make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:51.767495-08:00","updated_at":"2025-12-18T17:39:01.151928-08:00","closed_at":"2025-12-18T17:39:01.151931-08:00","dependencies":[{"issue_id":"locdoc-8pb","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.481639-08:00","created_by":"daemon"},{"issue_id":"locdoc-8pb","depends_on_id":"locdoc-phn","type":"blocks","created_at":"2025-12-18T16:18:19.898311-08:00","created_by":"daemon"}]}
{"id":"locdoc-92d","title":"Implement DeleteCmd with Kong","description":"Create cmd/locdoc/delete.go with DeleteCmd struct and Run method. Requires --force flag. Finds project by name and deletes.","acceptance_criteria":"- [ ] cmd/locdoc/delete.go exists\n- [ ] DeleteCmd struct with Name arg and Force flag\n- [ ] Run method requires --force, deletes project\n- [ ] Error if project not found\n- [ ] cmd/locdoc/delete_test.go with integration tests\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:19.890186-08:00","updated_at":"2025-12-11T20:01:11.678528-08:00","closed_at":"2025-12-11T20:01:11.678531-08:00","dependencies":[{"issue_id":"locdoc-92d","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.334153-08:00","created_by":"daemon"},{"issue_id":"locdoc-92d","depends_on_id":"locdoc-8cu","type":"blocks","created_at":"2025-12-11T17:48:03.995217-08:00","created_by":"daemon"}]}
{"id":"locdoc-9f6","title":"Add --filter flag to add command","description":"## Problem\nAdd --filter flag to add command that filters which URLs get crawled from the sitemap.\n\n## Requirements\n- **Regex patterns** (industry standard, already used in URLFilter)\n- **Multiple patterns via repeated flags**: `--filter \"docs\" --filter \"blog\"`\n- Patterns are OR'd together (URL passes if it matches ANY pattern)\n- Stored as newline-separated string in Project.Filter field\n- Converted to URLFilter.Include patterns at runtime\n\n## Implementation\n1. **Refactor first**: Extract CmdAdd flag parsing into `addOptions` struct + `parseAddArgs` function\n2. Add --filter to the options struct ([]string for multiple values)\n3. Pass filters to DiscoverURLs in preview mode\n4. Store filters on project creation\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n- locdoc.go (URLFilter already exists)\n\n## Validation\n- [ ] CmdAdd uses addOptions struct for clean parsing\n- [ ] --filter accepts regex pattern and stores on project\n- [ ] Multiple --filter flags can be specified\n- [ ] --preview --filter shows only matching URLs  \n- [ ] Crawl only fetches URLs matching at least one pattern\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:17.781395-08:00","updated_at":"2025-12-10T12:43:23.602359-08:00","closed_at":"2025-12-10T12:43:23.602361-08:00","dependencies":[{"issue_id":"locdoc-9f6","depends_on_id":"locdoc-tsu","type":"blocks","created_at":"2025-12-10T11:06:44.437565-08:00","created_by":"daemon"}]}
{"id":"locdoc-9h9","title":"Add DocumentFormatter to root package","description":"## Problem\n\nNeed a shared component to format documents for display and LLM context.\n\n## Entrypoints\n\n- Create new file `formatter.go` in root package\n\n## Implementation\n\n```go\n// DocumentFormatter formats documents for display or LLM context.\ntype DocumentFormatter interface {\n    Format(docs []*Document) string\n}\n```\n\nOr simpler, just a function type / concrete implementation.\n\nOutput format:\n```\n## Document: {title or source URL}\n{content}\n\n## Document: {title or source URL}\n{content}\n```\n\n- Use title if available, fall back to source URL\n- Documents separated by blank lines\n- Preserve markdown content as-is\n\n## Usage\n\n- `locdoc docs` prints this to stdout\n- `locdoc ask` wraps this in prompt template for Gemini\n\n## Validation\n\n- [ ] Formatter defined\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T18:00:37.792739-08:00","updated_at":"2025-12-09T19:44:53.984031-08:00","closed_at":"2025-12-09T19:44:53.984035-08:00","dependencies":[{"issue_id":"locdoc-9h9","depends_on_id":"locdoc-296","type":"blocks","created_at":"2025-12-09T18:00:42.552411-08:00","created_by":"daemon"}]}
{"id":"locdoc-9ix","title":"Add live progress reporting during crawl","description":"## Problem\nLong crawls (10+ minutes) show nothing until completion, leaving users unsure if the process is working.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - `crawlProject()`\n\n## Validation\n- [ ] Progress line shows: `[N/M] url (X failed, Y saved, ~Zk tokens)`\n- [ ] Progress updates in place using carriage return\n- [ ] Failures print on separate lines (persist in scroll history)\n- [ ] Progress updates as URLs complete (not batched at end)\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T15:41:17.7157-08:00","updated_at":"2025-12-10T18:24:54.685912-08:00","closed_at":"2025-12-10T18:24:54.685915-08:00"}
{"id":"locdoc-a3x","title":"Move retry logic to crawl package","description":"Move FetchWithRetry and related code from cmd/locdoc/retry.go to crawl/retry.go. Move tests to crawl/retry_test.go. Update any imports. Delete old files.","acceptance_criteria":"- [ ] crawl/retry.go contains retry logic\n- [ ] crawl/retry_test.go contains retry tests\n- [ ] cmd/locdoc/retry.go deleted\n- [ ] cmd/locdoc/retry_test.go deleted  \n- [ ] All retry tests pass\n- [ ] make validate passes","notes":"COMPLETED: Moved retry logic from cmd/locdoc to crawl package\n- crawl/retry.go: FetchWithRetry, FetchWithRetryDelays, DefaultRetryDelays, FetchFunc, LogFunc\n- crawl/retry_test.go: All unit tests\n- crawl/retry_integration_test.go: Integration test for exponential backoff\n- Updated cmd/locdoc/main.go to import and use crawl package\n- Deleted cmd/locdoc/retry.go and cmd/locdoc/retry_test.go\n\nVALIDATION: make validate passes (0 lint issues, all tests pass)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:44:57.545892-08:00","updated_at":"2025-12-11T18:48:10.115262-08:00","closed_at":"2025-12-11T18:48:10.115265-08:00","dependencies":[{"issue_id":"locdoc-a3x","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.241017-08:00","created_by":"daemon"},{"issue_id":"locdoc-a3x","depends_on_id":"locdoc-fyy","type":"blocks","created_at":"2025-12-11T17:48:03.864296-08:00","created_by":"daemon"}]}
{"id":"locdoc-a3y","title":"Epic: Documentation Crawler MVP","description":"## Overview\n\nImplement pure Go documentation crawler as defined in docs/plans/2025-12-07-crawling-design.md.\n\n## Scope\n\n- Sitemap-based URL discovery\n- Browser-based page fetching (JS rendering)\n- Content extraction and markdown conversion\n- SQLite storage\n\n## Success Criteria\n\n- `locdoc add \u003cname\u003e \u003curl\u003e` registers project\n- `locdoc crawl [name]` fetches pages from sitemap, stores as Markdown\n- `make validate` passes\n- Builds with `CGO_ENABLED=0`\n\n## Implementation Order\n\n1. sqlite/ - Storage foundation\n2. http/ - Sitemap parsing\n3. rod/ - Browser fetching\n4. trafilatura/ - Content extraction\n5. htmltomd/ - Markdown conversion\n6. cmd/locdoc/ - CLI wiring","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:00:37.291952-08:00","updated_at":"2025-12-09T14:26:04.271553-08:00","closed_at":"2025-12-09T14:26:04.271555-08:00"}
{"id":"locdoc-a4x","title":"Implement rod/ package","description":"## Problem\n\nNeed browser-based page fetching for JS-rendered documentation sites.\n\n## Entrypoints\n\n- Create `rod/` directory\n- Implement fetcher that returns rendered HTML\n\n## Requirements\n\n- Use `go-rod/rod` for Chrome automation\n- Launch Chrome or connect to existing instance\n- Navigate to URL, wait for JS to render\n- Return rendered HTML as string\n- Handle timeouts gracefully\n- Clean up browser resources on shutdown\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with mock browser (if feasible)\n- [ ] Integration test against real JS-heavy site\n- [ ] Verify Chrome requirement is documented\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- go-rod/rod documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.611936-08:00","updated_at":"2025-12-09T04:54:24.256482-08:00","closed_at":"2025-12-09T04:54:24.256485-08:00","dependencies":[{"issue_id":"locdoc-a4x","depends_on_id":"locdoc-k4l","type":"blocks","created_at":"2025-12-07T22:01:57.221765-08:00","created_by":"daemon"},{"issue_id":"locdoc-a4x","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.977866-08:00","created_by":"daemon"}]}
{"id":"locdoc-a7o","title":"Add --help flag to CLI","description":"## Problem\n\nCLI does not support --help or -h flags. Running 'locdoc --help' returns 'unknown command' error.\n\n## Entrypoints\n\n- cmd/locdoc/main.go\n\n## Implementation\n\nAdd case for 'help', '--help', '-h' in command switch that calls usage() without returning an error.\n\n## Validation\n\n- [ ] locdoc --help shows usage\n- [ ] locdoc -h shows usage\n- [ ] locdoc help shows usage\n- [ ] make validate passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T20:55:14.222704-08:00","updated_at":"2025-12-09T21:17:13.935164-08:00","closed_at":"2025-12-09T21:17:13.935168-08:00"}
{"id":"locdoc-amg","title":"Add Asker interface to root package","description":"## Problem\n\nNeed a domain interface for asking natural language questions about documentation.\n\n## Entrypoints\n\n- Create new file `asker.go` in root package\n\n## Implementation\n\n```go\n// Asker provides natural language question answering over documentation.\ntype Asker interface {\n    Ask(ctx context.Context, projectID string, question string) (string, error)\n}\n```\n\n## Validation\n\n- [ ] Interface defined in root package\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:46.880379-08:00","updated_at":"2025-12-09T20:26:16.589741-08:00","closed_at":"2025-12-09T20:26:16.589744-08:00"}
{"id":"locdoc-axo","title":"Use Gemini system instruction API field","description":"## Problem\nMove system instruction from inline prompt to the API's SystemInstruction field and add temperature config.\n\n## Entrypoints\n- gemini/asker.go: Ask method, add GenerateContentConfig\n\n## Validation\n- [ ] System instruction passed via genai.GenerateContentConfig.SystemInstruction\n- [ ] Temperature set to 0.4 via config\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T21:02:01.853053-08:00","updated_at":"2025-12-10T21:08:00.066423-08:00","closed_at":"2025-12-10T21:08:00.066428-08:00"}
{"id":"locdoc-bhp","title":"Implement ListCmd with Kong","description":"Create cmd/locdoc/list.go with ListCmd struct and Run method. Simple command - just calls ProjectService.FindProjects and formats output.","acceptance_criteria":"- [ ] cmd/locdoc/list.go exists\n- [ ] ListCmd struct (no arguments)\n- [ ] Run method lists projects with ID, name, URL\n- [ ] Shows helpful message when no projects exist\n- [ ] cmd/locdoc/list_test.go with integration tests\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:14.664954-08:00","updated_at":"2025-12-11T19:50:36.723161-08:00","closed_at":"2025-12-11T19:50:36.723164-08:00","dependencies":[{"issue_id":"locdoc-bhp","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.310929-08:00","created_by":"daemon"},{"issue_id":"locdoc-bhp","depends_on_id":"locdoc-8cu","type":"blocks","created_at":"2025-12-11T17:48:03.970589-08:00","created_by":"daemon"}]}
{"id":"locdoc-bqz","title":"Remove UpdateDocument and document update logic","description":"## Problem\n\nWith the new add/force workflow, documents are always created fresh - never updated:\n- New projects have no existing documents\n- Re-crawling requires --force which deletes the project (and all docs via CASCADE)\n\nThe UpdateDocument functionality is now dead code.\n\n## Changes\n\n1. Remove UpdateDocument from DocumentService interface (document.go)\n2. Remove DocumentUpdate struct (document.go)\n3. Remove UpdateDocument implementation (sqlite/document.go)\n4. Remove UpdateDocument tests (sqlite/document_test.go)\n5. Remove UpdateDocumentFn from mock (mock/document.go)\n6. Simplify crawlProject to only create documents (cmd/locdoc/main.go)\n7. Remove related tests in main_test.go\n\n## Entrypoints\n\n- document.go - interface and DocumentUpdate struct\n- sqlite/document.go - implementation\n- cmd/locdoc/main.go - crawlProject function\n\n## Validation\n\n- [ ] UpdateDocument removed from interface\n- [ ] DocumentUpdate struct removed\n- [ ] SQLite implementation removed\n- [ ] Mock updated\n- [ ] crawlProject simplified (no update branches)\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T14:30:10.333504-08:00","updated_at":"2025-12-10T14:49:37.010315-08:00","closed_at":"2025-12-10T14:49:37.010319-08:00"}
{"id":"locdoc-bxd","title":"Add mock implementation docs to go-standard-package-layout skill","description":"## Problem\n\nThe go-standard-package-layout skill doesn't document how to implement mocks following Ben Johnson's pattern.\n\n## Entrypoints\n\n- `/Users/filip/.claude/skills/go-standard-package-layout/go-standard-package-layout.md`\n\n## Requirements\n\nAdd a section on mock implementation patterns:\n- One file per entity in mock/ package (e.g., mock/user.go, mock/project.go)\n- Function fields pattern for dependency injection\n- Compile-time interface verification\n- Example from wtf repo\n\n## Validation\n\n- [ ] Skill file updated with mock section\n- [ ] Examples included","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T14:25:34.540459-08:00","updated_at":"2025-12-09T14:50:18.181082-08:00","closed_at":"2025-12-09T14:50:18.181087-08:00"}
{"id":"locdoc-c1n","title":"Remove old command functions and clean up main.go","description":"Delete old CmdAdd, CmdList, CmdDelete, CmdDocs, CmdAsk functions. Delete ParseAddArgs. Delete CrawlDeps, AddOptions. Delete crawlProject, processURL. Clean up imports. Main.go should only contain Main struct, CLI struct, Dependencies, and wiring.","acceptance_criteria":"- [ ] All Cmd* functions deleted\n- [ ] ParseAddArgs deleted\n- [ ] CrawlDeps, AddOptions deleted\n- [ ] crawlProject, processURL deleted\n- [ ] main.go is ~100-150 lines\n- [ ] make validate passes\n- [ ] All existing tests pass (via new implementation)","notes":"COMPLETED: All old command functions deleted\n- Removed CmdAdd, CmdList, CmdDelete, CmdDocs, CmdAsk\n- Removed ParseAddArgs, AddOptions, CrawlDeps, crawlResult\n- Removed crawlProject, processURL, ComputeHashForTest\n- Removed runAdd, runList, runDelete, runDocs, runAsk methods\n- Updated Run() to use Kong's Parse + Run dispatch\n- Cleaned up imports\n- main.go now 173 lines (was 822)\n- main_test.go now 92 lines (was 1618)\n- All tests pass, make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:43.304843-08:00","updated_at":"2025-12-11T20:40:42.433484-08:00","closed_at":"2025-12-11T20:40:42.433487-08:00","dependencies":[{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.427792-08:00","created_by":"daemon"},{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-63p","type":"blocks","created_at":"2025-12-11T17:48:04.096532-08:00","created_by":"daemon"},{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-bhp","type":"blocks","created_at":"2025-12-11T17:48:04.123863-08:00","created_by":"daemon"},{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-92d","type":"blocks","created_at":"2025-12-11T17:48:04.15076-08:00","created_by":"daemon"},{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-o5n","type":"blocks","created_at":"2025-12-11T17:48:04.176131-08:00","created_by":"daemon"},{"issue_id":"locdoc-c1n","depends_on_id":"locdoc-c7n","type":"blocks","created_at":"2025-12-11T17:48:12.545202-08:00","created_by":"daemon"}]}
{"id":"locdoc-c4s","title":"Create mock package skeleton","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.293012-08:00","updated_at":"2025-12-07T19:12:29.650324-08:00","closed_at":"2025-12-07T19:12:29.650327-08:00","dependencies":[{"issue_id":"locdoc-c4s","depends_on_id":"locdoc-1h6","type":"blocks","created_at":"2025-12-07T16:41:00.022992-08:00","created_by":"daemon"}]}
{"id":"locdoc-c7n","title":"Implement AskCmd with Kong","description":"Create cmd/locdoc/ask.go with AskCmd struct and Run method. Takes project name and question, uses Asker service to get answer.","acceptance_criteria":"- [ ] cmd/locdoc/ask.go exists\n- [ ] AskCmd struct with Name and Question args\n- [ ] Run method calls Asker.Ask and prints result\n- [ ] Error if project not found\n- [ ] cmd/locdoc/ask_test.go with integration tests\n- [ ] make validate passes","notes":"COMPLETED: Implemented AskCmd with Kong\n- Created ask.go with Run method\n- Created ask_test.go with 4 test cases (happy path, project not found, FindProjects error, Asker error)\n- Removed stub Run method from cli.go\n- make validate passes\n\nAll acceptance criteria met:\n- cmd/locdoc/ask.go exists ✓\n- AskCmd struct with Name and Question args ✓ (already in cli.go)\n- Run method calls Asker.Ask and prints result ✓\n- Error if project not found ✓\n- cmd/locdoc/ask_test.go with integration tests ✓\n- make validate passes ✓","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:30.439382-08:00","updated_at":"2025-12-11T20:19:08.998186-08:00","closed_at":"2025-12-11T20:19:08.998189-08:00","dependencies":[{"issue_id":"locdoc-c7n","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.380711-08:00","created_by":"daemon"},{"issue_id":"locdoc-c7n","depends_on_id":"locdoc-8cu","type":"blocks","created_at":"2025-12-11T17:48:04.043334-08:00","created_by":"daemon"}]}
{"id":"locdoc-co5","title":"Add --force flag to add command","description":"Add --force flag that deletes existing project before creating new one.\n\n## Behavior\n- Without --force: error if project exists\n- With --force: delete existing project + docs, then create + crawl\n- Enables re-crawling via delete + recreate pattern\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n\n## Validation\n- [ ] --force deletes existing and recreates\n- [ ] Without --force, error on existing project\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:29.922497-08:00","updated_at":"2025-12-10T13:46:00.791702-08:00","closed_at":"2025-12-10T13:46:00.791704-08:00","dependencies":[{"issue_id":"locdoc-co5","depends_on_id":"locdoc-2zl","type":"blocks","created_at":"2025-12-10T11:06:44.573399-08:00","created_by":"daemon"}]}
{"id":"locdoc-d6s","title":"Implement generic fallback link selector","description":"Create generic selector using universal CSS selectors that work across any documentation framework.\n\n## Entrypoints\n- Create goquery/selector_generic.go - GenericSelector using nav, aside, .sidebar, etc.\n- Create goquery/selector_generic_test.go\n\n## Validation\n- Extracts navigation links from arbitrary HTML\n- Priority: TOC \u003e nav \u003e content \u003e footer\n- make validate passes","notes":"COMPLETED: GenericSelector implementation with TDD\n- Created goquery/selector_generic.go with universal CSS selectors\n- Created goquery/selector_generic_test.go with 12 test cases\n- Selectors: .toc, .sidebar, .table-of-contents, aside (TOC priority)\n- Selectors: nav, [role=navigation], .nav, .menu, .navbar (nav priority)\n- Selectors: main, article, .content, .doc-content (content priority)\n- Selectors: footer, .footer (footer priority)\n- All tests pass, make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:52.519571-08:00","updated_at":"2025-12-18T17:20:15.013916-08:00","closed_at":"2025-12-18T17:20:15.013919-08:00","dependencies":[{"issue_id":"locdoc-d6s","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.604457-08:00","created_by":"daemon"},{"issue_id":"locdoc-d6s","depends_on_id":"locdoc-nwx","type":"blocks","created_at":"2025-12-18T16:18:22.623627-08:00","created_by":"daemon"}]}
{"id":"locdoc-ecb","title":"Epic: Ask Command","description":"## Overview\n\nImplement the `locdoc ask \u003cproject\u003e \"question\"` command that queries documentation using Gemini Flash.\n\n## Design\n\nSee docs/plans/2025-12-09-ask-command-design.md\n\n## Scope\n\n- Add `Asker` interface to root package\n- Implement `gemini/` package wrapping Gemini API\n- Add `CmdAsk` to CLI\n- LLM-friendly error messages\n\n## Validation\n\n- [ ] `locdoc ask \u003cproject\u003e \"question\"` returns useful answers\n- [ ] Error messages guide users to correct usage\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:42.085842-08:00","updated_at":"2025-12-09T21:27:11.834105-08:00","closed_at":"2025-12-09T21:27:11.83411-08:00","dependencies":[{"issue_id":"locdoc-ecb","depends_on_id":"locdoc-il8","type":"blocks","created_at":"2025-12-09T16:29:04.693172-08:00","created_by":"daemon"}]}
{"id":"locdoc-fx7","title":"Sandwich pattern with structured sources output","description":"## Problem\nAdd trailing instructions after the question (sandwich pattern) and require structured Sources section in output.\n\n## Entrypoints\n- gemini/asker.go: buildPrompt/buildUserMessage function\n\n## Validation\n- [ ] Question wrapped in \u003cquestion\u003e tags\n- [ ] Trailing \u003cinstructions\u003e block after question\n- [ ] Instructions specify Sources format: ---\\nSources:\\n- url1\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T21:02:16.778964-08:00","updated_at":"2025-12-10T21:21:45.970054-08:00","closed_at":"2025-12-10T21:21:45.970057-08:00"}
{"id":"locdoc-fyy","title":"Create crawl package with Crawler struct and types","description":"Create crawl/ package with Crawler struct, Result type, ProgressEvent type, ProgressFunc type. No implementation yet - just the API surface. Include compile-time interface check placeholder.","acceptance_criteria":"- [ ] crawl/crawl.go exists with Crawler struct\n- [ ] All dependency fields on Crawler (Sitemaps, Fetcher, etc.)\n- [ ] Result, ProgressEvent, ProgressType, ProgressFunc types defined\n- [ ] CrawlProject method signature (can return nil, nil for now)\n- [ ] make validate passes","notes":"COMPLETED: Created crawl package with API surface\n- crawl/crawl.go: Crawler struct with all dependency fields\n- Result, ProgressEvent, ProgressType, ProgressFunc types\n- CrawlProject stub method (returns nil, nil)\n- crawl/crawl_test.go with type verification tests\n- make validate passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:44:52.252999-08:00","updated_at":"2025-12-11T18:12:56.469321-08:00","closed_at":"2025-12-11T18:12:56.469325-08:00","dependencies":[{"issue_id":"locdoc-fyy","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.217457-08:00","created_by":"daemon"}]}
{"id":"locdoc-gc0","title":"Implement trafilatura/ package","description":"## Problem\n\nNeed content extraction to remove boilerplate from crawled pages.\n\n## Entrypoints\n\n- Create `trafilatura/` directory\n- Wrap go-trafilatura library API\n\n## Requirements\n\n- Accept raw HTML string\n- Return clean HTML + title (metadata)\n- Remove boilerplate (nav, footer, sidebar, ads)\n- Preserve main content structure\n- Use go-trafilatura library (not CLI)\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with HTML fixtures\n- [ ] Test against various doc site formats (Docusaurus, MkDocs, etc.)\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/markusmobius/go-trafilatura examples/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.742322-08:00","updated_at":"2025-12-09T12:04:36.268301-08:00","closed_at":"2025-12-09T12:04:36.268308-08:00","dependencies":[{"issue_id":"locdoc-gc0","depends_on_id":"locdoc-a4x","type":"blocks","created_at":"2025-12-07T22:01:57.250498-08:00","created_by":"daemon"},{"issue_id":"locdoc-gc0","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.004233-08:00","created_by":"daemon"}]}
{"id":"locdoc-glt","title":"Path prefix filter not matching URLs without trailing slash","description":"## Resolution\n\n**Not a bug** - htmx.org's sitemap genuinely only contains 1 URL under `/docs/`:\n\n```\nPath breakdown (179 total URLs):\n49 /essays/\n36 /posts/\n36 /attributes/\n30 /examples/\n 9 /extensions/\n 7 /headers/\n 1 /docs/        ← Only this one!\n 1 /api/\n 1 /reference/\n```\n\nhtmx.org organizes documentation under `/attributes/`, `/api/`, `/reference/`, etc. - NOT under `/docs/`. The `/docs/` page is just a landing page.\n\n**The path prefix filtering works correctly.** To crawl htmx docs, use `https://htmx.org/` (no path filter) or target specific paths like `/attributes/`.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T07:55:47.487493-08:00","updated_at":"2025-12-10T07:57:30.738468-08:00","closed_at":"2025-12-10T07:57:30.738472-08:00"}
{"id":"locdoc-h4h","title":"Add locdoc docs command","description":"## Problem\n\nNeed a way to inspect stored documents for a project.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/cmd/locdoc/main.go`\n\n## Implementation\n\n1. Add to usage():\n```\ndocs \u003cname\u003e [--full]   List documents for a project (--full for content)\n```\n\n2. Add case to Run() switch\n\n3. Implement CmdDocs()\n\n### Default mode: `locdoc docs \u003cproject\u003e`\n\nSummary listing:\n```\nDocuments for inngest (42 total):\n\n  1. Getting Started\n     https://inngest.com/docs/getting-started\n  2. Functions\n     https://inngest.com/docs/functions\n```\n\n### Full mode: `locdoc docs \u003cproject\u003e --full`\n\nFull formatted content (same as what ask sends to Gemini):\n```\n## Document: Getting Started\n{full markdown content}\n\n## Document: Functions\n{full markdown content}\n```\n\nUses DocumentFormatter for full output.\n\n### Error messages\n\n- Project not found: `project \"foo\" not found. Use \"locdoc list\" to see available projects.`\n- No documents: `project \"foo\" has no documents. Run \"locdoc crawl foo\" first.`\n\n## Validation\n\n- [ ] `locdoc docs \u003cproject\u003e` shows summary listing\n- [ ] `locdoc docs \u003cproject\u003e --full` shows full content\n- [ ] Full output matches what ask command sends to LLM\n- [ ] Error messages are helpful\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:23.564894-08:00","updated_at":"2025-12-09T20:01:24.57742-08:00","closed_at":"2025-12-09T20:01:24.577423-08:00","dependencies":[{"issue_id":"locdoc-h4h","depends_on_id":"locdoc-4qp","type":"blocks","created_at":"2025-12-09T17:57:42.690932-08:00","created_by":"daemon"},{"issue_id":"locdoc-h4h","depends_on_id":"locdoc-9h9","type":"blocks","created_at":"2025-12-09T18:00:42.576965-08:00","created_by":"daemon"}]}
{"id":"locdoc-hhk","title":"Add SQLite connection pool and busy timeout settings","description":"## Problem\n\nSQLite has connection pool and timeout settings that can prevent \"database is locked\" errors and improve robustness.\n\n## Entrypoints\n\n- `sqlite/sqlite.go` - `Open()` method\n\n## Suggested Settings\n\nFrom Ben Johnson's WTF:\n- `db.SetMaxOpenConns(1)` - SQLite only supports one writer anyway\n- `PRAGMA busy_timeout = 5000` - Wait 5s instead of failing immediately on lock\n\n## References\n\n- https://github.com/benbjohnson/wtf/blob/main/sqlite/sqlite.go\n\n## Validation\n\n- [ ] Settings applied in `Open()`\n- [ ] `make validate` passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T13:20:05.81999-08:00","updated_at":"2025-12-09T19:37:05.779579-08:00","closed_at":"2025-12-09T19:37:05.779582-08:00"}
{"id":"locdoc-hw3","title":"Create CLAUDE.md with AI agent instructions","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:31.845746-08:00","updated_at":"2025-12-07T16:51:04.766651-08:00","closed_at":"2025-12-07T16:51:04.766654-08:00"}
{"id":"locdoc-i7h","title":"CLI refactor: Kong + crawl package extraction","description":"Refactor cmd/locdoc to use Kong CLI library and extract crawl orchestration to dedicated package. See docs/plans/2025-12-11-cli-refactor-design.md for full design.","acceptance_criteria":"- [ ] Kong handles all argument parsing\n- [ ] crawl/ package contains crawl orchestration logic\n- [ ] cmd/locdoc/ has one file per command\n- [ ] Test count reduced by ~80%\n- [ ] make validate passes\n- [ ] CLI interface unchanged (same commands, flags, output)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T17:44:39.588662-08:00","updated_at":"2025-12-11T21:05:31.812934-08:00","closed_at":"2025-12-11T21:05:31.812937-08:00"}
{"id":"locdoc-iam","title":"Update Gemini asker tests for new prompt structure","description":"## Problem\nUpdate unit and integration tests to verify the new prompt structure works correctly.\n\n## Entrypoints\n- gemini/asker_test.go\n- gemini/asker_integration_test.go\n\n## Validation\n- [ ] Unit tests verify system instruction is set\n- [ ] Unit tests verify temperature is 0.4\n- [ ] Unit tests verify XML document structure\n- [ ] Integration test passes with real Gemini API\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T21:02:22.216806-08:00","updated_at":"2025-12-10T21:23:04.065207-08:00","closed_at":"2025-12-10T21:23:04.065219-08:00","dependencies":[{"issue_id":"locdoc-iam","depends_on_id":"locdoc-axo","type":"blocks","created_at":"2025-12-10T21:02:29.950252-08:00","created_by":"daemon"},{"issue_id":"locdoc-iam","depends_on_id":"locdoc-zml","type":"blocks","created_at":"2025-12-10T21:02:29.973858-08:00","created_by":"daemon"},{"issue_id":"locdoc-iam","depends_on_id":"locdoc-fx7","type":"blocks","created_at":"2025-12-10T21:02:29.997524-08:00","created_by":"daemon"}]}
{"id":"locdoc-il8","title":"Implement CmdAsk in CLI","description":"## Problem\n\nNeed CLI command to ask questions about project documentation.\n\n## Entrypoints\n\n- `cmd/locdoc/main.go`\n\n## Implementation\n\nAdd `CmdAsk` function that:\n1. Parses args: `locdoc ask \u003cproject\u003e \"question\"`\n2. Looks up project by name\n3. Fetches all documents for project\n4. Validates project has documents\n5. Calls `Asker.Ask()`\n6. Prints result to stdout\n\n## Error Messages\n\nProject not found:\n```\nproject \"foo\" not found. Use \"locdoc list\" to see available projects, or \"locdoc add \u003cname\u003e \u003curl\u003e\" to add one.\n```\n\nNo documents:\n```\nproject \"foo\" has no documents. Run \"locdoc crawl foo\" to fetch documentation first.\n```\n\nMissing API key:\n```\nGEMINI_API_KEY environment variable not set. Get an API key at https://aistudio.google.com/apikey\n```\n\n## Validation\n\n- [ ] `locdoc ask` with wrong args shows usage\n- [ ] Missing project shows helpful error\n- [ ] Empty project shows helpful error\n- [ ] Missing API key shows helpful error\n- [ ] Valid query returns answer\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:59.19651-08:00","updated_at":"2025-12-09T21:03:30.728479-08:00","closed_at":"2025-12-09T21:03:30.728482-08:00","dependencies":[{"issue_id":"locdoc-il8","depends_on_id":"locdoc-4nk","type":"blocks","created_at":"2025-12-09T16:29:04.632737-08:00","created_by":"daemon"},{"issue_id":"locdoc-il8","depends_on_id":"locdoc-n3w","type":"blocks","created_at":"2025-12-09T17:57:42.761146-08:00","created_by":"daemon"},{"issue_id":"locdoc-il8","depends_on_id":"locdoc-9h9","type":"blocks","created_at":"2025-12-09T18:00:42.600797-08:00","created_by":"daemon"}]}
{"id":"locdoc-ipo","title":"Centralize SQLite DB path resolution in main","description":"## Problem\nDB path resolution logic (checking LOCDOC_DB env var, falling back to ~/.locdoc/locdoc.db) should happen once in main and the resolved path injected to components that need it.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - resolve DB path once at startup\n- Any component currently resolving the path independently\n\n## Validation\n- [ ] DB path resolved once in main\n- [ ] Path injected to sqlite.Open or equivalent\n- [ ] `make validate` passes","notes":"COMPLETED: Task was already implemented. Analysis confirmed:\n- defaultDBPath() in main.go:165-176 resolves LOCDOC_DB env var with fallback to ~/.locdoc/locdoc.db\n- NewMain() calls this once and stores in m.DBPath\n- Path injected to sqlite.NewDB(m.DBPath) at main.go:101\n- sqlite package has no knowledge of env vars or defaults\n\nAll validation criteria met.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T12:14:38.336874-08:00","updated_at":"2025-12-18T17:27:30.927238-08:00","closed_at":"2025-12-18T17:27:30.927241-08:00"}
{"id":"locdoc-k37","title":"Add rod.Fetcher lifecycle tests","description":"Missing tests for constructor and Close() behavior. Need to verify options pattern works, Close() is idempotent, and Fetch() after Close() returns appropriate error.","acceptance_criteria":"- [ ] Test NewFetcher with WithFetchTimeout option\n- [ ] Test Close() can be called multiple times safely\n- [ ] Test Fetch() after Close() returns error\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T20:50:08.49399-08:00","updated_at":"2025-12-17T12:05:55.728813-08:00","closed_at":"2025-12-17T12:05:55.728817-08:00"}
{"id":"locdoc-k4l","title":"Implement sqlite/ package","description":"## Problem\n\nNeed SQLite storage layer using pure Go driver (no CGO).\n\n## Entrypoints\n\n- Create `sqlite/` directory\n- Implement `ProjectService` interface from project.go\n- Implement `DocumentService` interface from document.go\n\n## Requirements\n\n- Use `ncruces/go-sqlite3` with `database/sql` driver\n- Auto-create schema on first run (migrations)\n- Store document content as Markdown text\n- Content hash (xxHash) for change detection\n- Compile-time interface verification: `var _ locdoc.ProjectService = (*ProjectService)(nil)`\n\n## Validation\n\n- [ ] Unit tests for CRUD operations\n- [ ] Integration test with real SQLite file\n- [ ] `make validate` passes\n- [ ] Builds with `CGO_ENABLED=0`\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:00:47.279328-08:00","updated_at":"2025-12-08T12:37:13.040666-08:00","closed_at":"2025-12-08T12:37:13.04067-08:00","dependencies":[{"issue_id":"locdoc-k4l","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.920979-08:00","created_by":"daemon"}]}
{"id":"locdoc-knx","title":"Create Makefile with validate target","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:31.93188-08:00","updated_at":"2025-12-07T16:52:33.128539-08:00","closed_at":"2025-12-07T16:52:33.128541-08:00"}
{"id":"locdoc-ksr","title":"Wire new dependencies in main","description":"Wire LinkSelectorRegistry and DomainLimiter in cmd/locdoc/main.go.\n\n## Entrypoints\n- Modify cmd/locdoc/main.go - create registry, limiter, inject into Crawler\n\n## Validation\n- CLI works end-to-end with recursive crawling\n- make validate passes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T16:08:11.236073-08:00","updated_at":"2025-12-18T16:08:11.236073-08:00","dependencies":[{"issue_id":"locdoc-ksr","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:40.039095-08:00","created_by":"daemon"},{"issue_id":"locdoc-ksr","depends_on_id":"locdoc-5kd","type":"blocks","created_at":"2025-12-18T16:18:25.320194-08:00","created_by":"daemon"}]}
{"id":"locdoc-l3o","title":"Add mock implementations for new interfaces","description":"Add mock implementations to mock/ package for testing.\n\n## Entrypoints\n- Create/update mock/linkselector.go - LinkSelector, FrameworkDetector, LinkSelectorRegistry mocks\n- Create/update mock/frontier.go - URLFrontier, DomainLimiter mocks\n\n## Validation\n- All mocks have function fields matching interface methods\n- Compile-time interface verification\n- make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:08:10.615167-08:00","updated_at":"2025-12-18T16:36:16.077411-08:00","closed_at":"2025-12-18T16:36:16.077415-08:00","dependencies":[{"issue_id":"locdoc-l3o","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.921225-08:00","created_by":"daemon"},{"issue_id":"locdoc-l3o","depends_on_id":"locdoc-phn","type":"blocks","created_at":"2025-12-18T16:18:20.086323-08:00","created_by":"daemon"}]}
{"id":"locdoc-l52","title":"Improve crawl command output with summary statistics","description":"## Problem\n\nAfter making crawl concurrent, the output now dumps as a wall of text at the end instead of streaming progress. The verbose per-URL output isn't useful when it all appears at once.\n\n## Design\n\nSee [docs/plans/2025-12-10-crawl-summary-token-counting.md](../docs/plans/2025-12-10-crawl-summary-token-counting.md)\n\n**Summary:**\n- Add `TokenCounter` interface to root package\n- Implement in `gemini/` package using `google.golang.org/genai/tokenizer`\n- Model const (`gemini-2.5-flash`) in main, passed to tokenizer\n- Count tokens during crawl results loop, accumulate totals\n- Replace per-URL output with summary: `Saved 179 pages (2.3 MB, ~580k tokens)`\n\n## Entrypoints\n\n- `locdoc.go` - Add TokenCounter interface\n- `gemini/token.go` - New implementation\n- `mock/token.go` - New mock\n- `cmd/locdoc/main.go` - Wire tokenizer, update crawlProject output\n\n## Validation\n\n- [ ] Crawl shows summary instead of per-URL output\n- [ ] Summary includes page count, size, and token count\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T08:00:39.134594-08:00","updated_at":"2025-12-10T09:26:21.02203-08:00","closed_at":"2025-12-10T09:26:21.022032-08:00"}
{"id":"locdoc-lf5","title":"Implement URL frontier with priority queue","description":"Create in-memory URLFrontier with priority queue and Bloom filter deduplication.\n\n## Entrypoints\n- Create crawl/frontier.go - Frontier struct implementing locdoc.URLFrontier\n- Use container/heap for priority queue\n- Use bloom/ package for deduplication\n- Create crawl/frontier_test.go\n\n## Validation\n- Pop() returns highest priority URL first\n- Push() returns false for already-seen URLs\n- Memory-efficient for 10k+ URLs\n- make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:08:10.234413-08:00","updated_at":"2025-12-18T17:53:56.303628-08:00","closed_at":"2025-12-18T17:53:56.303631-08:00","dependencies":[{"issue_id":"locdoc-lf5","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.862066-08:00","created_by":"daemon"},{"issue_id":"locdoc-lf5","depends_on_id":"locdoc-8pb","type":"blocks","created_at":"2025-12-18T16:18:22.558785-08:00","created_by":"daemon"}]}
{"id":"locdoc-m6o","title":"Fix rod.Fetcher launcher resource leak","description":"The launcher process is created but not stored in NewFetcher, making proper cleanup impossible in Close(). The launcher should be stored in the Fetcher struct and killed during Close().","acceptance_criteria":"- [ ] Launcher stored in Fetcher struct\n- [ ] Close() kills launcher process after closing browser\n- [ ] make validate passes","notes":"COMPLETED: \n- Added launcher field to Fetcher struct\n- Store launcher instance in NewFetcher\n- Added LauncherPID() method for testing\n- Updated Close() to kill launcher after closing browser\n- Added integration test verifying launcher cleanup\n\nVALIDATION: make validate passes","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-15T20:50:08.384931-08:00","updated_at":"2025-12-15T20:56:08.446975-08:00","closed_at":"2025-12-15T20:56:08.446978-08:00"}
{"id":"locdoc-mdd","title":"Implement htmltomd/ package","description":"## Problem\n\nNeed HTML to Markdown conversion for storage.\n\n## Entrypoints\n\n- Create `htmltomarkdown/` directory\n- Wrap html-to-markdown library\n\n## Requirements\n\n- Accept clean HTML string\n- Return Markdown string\n- Preserve code blocks with language hints\n- Preserve tables, links, headings\n- Use `JohannesKaufmann/html-to-markdown` library\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with HTML fixtures\n- [ ] Test code block preservation\n- [ ] Test table conversion\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/JohannesKaufmann/html-to-markdown","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.868426-08:00","updated_at":"2025-12-09T12:24:43.88477-08:00","closed_at":"2025-12-09T12:24:43.884774-08:00","dependencies":[{"issue_id":"locdoc-mdd","depends_on_id":"locdoc-gc0","type":"blocks","created_at":"2025-12-07T22:01:57.281633-08:00","created_by":"daemon"},{"issue_id":"locdoc-mdd","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.032944-08:00","created_by":"daemon"}]}
{"id":"locdoc-mtz","title":"Implement http/ package","description":"## Problem\n\nNeed sitemap discovery and parsing for URL extraction.\n\n## Entrypoints\n\n- Create `http/` directory\n- Port sitemap logic from go-trafilatura cmd/\n\n## Requirements\n\n- Discover sitemap URL from robots.txt (`Sitemap:` directive)\n- Fall back to `/sitemap.xml` if not found\n- Parse sitemap XML using `beevik/etree`\n- Handle sitemap indexes recursively\n- Filter URLs by pattern (include/exclude regex)\n- Return list of discovered URLs\n- Respect context cancellation\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with sitemap XML fixtures\n- [ ] Integration test against real site (e.g., go.dev)\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/markusmobius/go-trafilatura/cmd/go-trafilatura/sitemap.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.476838-08:00","updated_at":"2025-12-08T13:38:49.035033-08:00","closed_at":"2025-12-08T13:38:49.035037-08:00","dependencies":[{"issue_id":"locdoc-mtz","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.951025-08:00","created_by":"daemon"}]}
{"id":"locdoc-n3w","title":"Capture sitemap position during crawl","description":"## Problem\n\ncrawlProject() has the loop index but does not store it as document position.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/cmd/locdoc/main.go` - crawlProject()\n\n## Implementation\n\n1. Set Position when creating document:\n```go\ndoc := \u0026locdoc.Document{\n    // ... existing fields ...\n    Position: i,\n}\n```\n\n2. Include position when updating:\n```go\nposition := i\ndocuments.UpdateDocument(ctx, existing.ID, locdoc.DocumentUpdate{\n    // ... existing fields ...\n    Position: \u0026position,\n})\n```\n\n3. Update position even when content unchanged:\n```go\nif existing != nil \u0026\u0026 existing.ContentHash == hash {\n    if existing.Position != i {\n        position := i\n        documents.UpdateDocument(ctx, existing.ID, locdoc.DocumentUpdate{\n            Position: \u0026position,\n        })\n        fmt.Fprintln(stdout, \"    position updated\")\n    } else {\n        fmt.Fprintln(stdout, \"    unchanged\")\n    }\n    continue\n}\n```\n\n## Validation\n\n- [ ] New documents get correct position\n- [ ] Updated documents get correct position\n- [ ] Position updates when content unchanged but position changed\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:16.281017-08:00","updated_at":"2025-12-09T19:14:08.609013-08:00","closed_at":"2025-12-09T19:14:08.609016-08:00","dependencies":[{"issue_id":"locdoc-n3w","depends_on_id":"locdoc-4qp","type":"blocks","created_at":"2025-12-09T17:57:42.619239-08:00","created_by":"daemon"}]}
{"id":"locdoc-ndt","title":"Flush stdout after progress updates","description":"## Problem\nProgress line during crawl uses carriage return (\\\\r) for in-place updates, but Go's fmt.Fprintf to os.Stdout is buffered. Output may sit in buffer and not render until a newline forces a flush, making progress invisible.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - `crawlProject()` around line 510\n\n## Validation\n- [ ] Progress line visible during crawl (test with slow network or large site)\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T18:43:14.85788-08:00","updated_at":"2025-12-10T18:44:44.484418-08:00","closed_at":"2025-12-10T18:44:44.484421-08:00"}
{"id":"locdoc-nle","title":"Add Kong dependency and create CLI struct skeleton","description":"Add Kong to go.mod. Create basic CLI struct with all 5 command structs (AddCmd, ListCmd, DeleteCmd, DocsCmd, AskCmd) with correct struct tags. Wire Kong parser in Main.Run(). Commands can be empty stubs that return nil.","acceptance_criteria":"- [ ] go get github.com/alecthomas/kong\n- [ ] CLI struct with 5 command structs defined\n- [ ] Kong parser created with Writers(stdout, stderr)\n- [ ] locdoc --help shows all commands\n- [ ] make validate passes","notes":"COMPLETED: Kong CLI skeleton\n- Added github.com/alecthomas/kong dependency\n- Created CLI struct with AddCmd, ListCmd, DeleteCmd, DocsCmd, AskCmd\n- All command structs have proper Kong struct tags\n- All commands have stub Run() methods returning nil\n- Kong parser wired in Main.Run() with Writers(stdout, stderr)\n- --help now uses Kong formatting\n- All tests passing, make validate passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:44:46.090614-08:00","updated_at":"2025-12-11T17:59:39.280092-08:00","closed_at":"2025-12-11T17:59:39.280094-08:00","dependencies":[{"issue_id":"locdoc-nle","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.193323-08:00","created_by":"daemon"}]}
{"id":"locdoc-nnd","title":"Create .claude/ commands","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.484792-08:00","updated_at":"2025-12-07T20:31:12.324995-08:00","closed_at":"2025-12-07T20:31:12.324998-08:00"}
{"id":"locdoc-nwx","title":"Implement base link selector with goquery","description":"Create goquery/ package with shared baseSelector logic for extracting prioritized links from HTML.\n\n## Entrypoints\n- Create goquery/selector_base.go - baseSelector struct with ExtractLinks() using CSS selectors\n- Handle URL resolution, deduplication, priority scoring\n- Create goquery/selector_base_test.go\n\n## Validation\n- Extracts links from nav/aside/main/footer with correct priorities\n- Resolves relative URLs correctly\n- Filters external links\n- make validate passes","notes":"COMPLETED: Implementation of BaseSelector in goquery/ package\n- Implements locdoc.LinkSelector interface\n- Extracts links from nav (PriorityNavigation), aside (PriorityTOC), main/article (PriorityContent), footer (PriorityFooter)\n- Resolves relative URLs correctly\n- Filters external links (different host)\n- Deduplicates links keeping highest priority\n- All tests pass with make validate","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:52.131301-08:00","updated_at":"2025-12-18T16:51:02.436642-08:00","closed_at":"2025-12-18T16:51:02.436644-08:00","dependencies":[{"issue_id":"locdoc-nwx","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.544736-08:00","created_by":"daemon"},{"issue_id":"locdoc-nwx","depends_on_id":"locdoc-phn","type":"blocks","created_at":"2025-12-18T16:18:19.964609-08:00","created_by":"daemon"}]}
{"id":"locdoc-o5n","title":"Implement DocsCmd with Kong","description":"Create cmd/locdoc/docs.go with DocsCmd struct and Run method. Lists documents for a project. --full flag shows full content.","acceptance_criteria":"- [ ] cmd/locdoc/docs.go exists\n- [ ] DocsCmd struct with Name arg and Full flag\n- [ ] Run method shows document list (title, URL)\n- [ ] --full shows formatted content via locdoc.FormatDocuments\n- [ ] Error if project not found or has no documents\n- [ ] cmd/locdoc/docs_test.go with integration tests\n- [ ] make validate passes","notes":"COMPLETED: All acceptance criteria met\n- cmd/locdoc/docs.go created with DocsCmd.Run method\n- DocsCmd struct with Name arg and Full flag (already in cli.go)\n- Run method shows document list (title, URL) in summary mode\n- --full flag shows formatted content via locdoc.FormatDocuments\n- Error handling for project not found and no documents\n- cmd/locdoc/docs_test.go with 7 integration tests\n- make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:45:25.265976-08:00","updated_at":"2025-12-11T20:09:33.509061-08:00","closed_at":"2025-12-11T20:09:33.509064-08:00","dependencies":[{"issue_id":"locdoc-o5n","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.357382-08:00","created_by":"daemon"},{"issue_id":"locdoc-o5n","depends_on_id":"locdoc-8cu","type":"blocks","created_at":"2025-12-11T17:48:04.018704-08:00","created_by":"daemon"}]}
{"id":"locdoc-oj9","title":"Add rod.Fetcher concurrent usage test","description":"Line 21 claims Fetcher is safe for concurrent use, but there are no tests verifying this. Add a test that calls Fetch() from multiple goroutines concurrently to validate thread-safety under race detector.","acceptance_criteria":"- [ ] Test concurrent Fetch() calls from multiple goroutines\n- [ ] Test passes with -race flag\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T20:50:08.601455-08:00","updated_at":"2025-12-17T20:19:44.221592-08:00","closed_at":"2025-12-17T20:19:44.221595-08:00"}
{"id":"locdoc-ot9","title":"Remove crawl command","description":"Remove the standalone crawl command now that add handles crawling.\n\n## Changes\n- Remove CmdCrawl function\n- Remove crawl case from command dispatch\n- Update help text\n- Update any docs referencing crawl\n\n## Entrypoints\n- cmd/locdoc/main.go\n\n## Validation\n- [ ] crawl command removed\n- [ ] Help text updated\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:35.912545-08:00","updated_at":"2025-12-10T14:28:15.605143-08:00","closed_at":"2025-12-10T14:28:15.605146-08:00","dependencies":[{"issue_id":"locdoc-ot9","depends_on_id":"locdoc-co5","type":"blocks","created_at":"2025-12-10T11:06:44.640437-08:00","created_by":"daemon"},{"issue_id":"locdoc-ot9","depends_on_id":"locdoc-9f6","type":"blocks","created_at":"2025-12-10T11:06:44.70731-08:00","created_by":"daemon"}]}
{"id":"locdoc-phn","title":"Define domain types for link selection and frontier","description":"Add domain types and interfaces for link selection, framework detection, and URL frontier to the root package.\n\n## Entrypoints\n- Create linkselector.go - LinkPriority, DiscoveredLink, Framework, LinkSelector, FrameworkDetector, LinkSelectorRegistry\n- Create frontier.go - URLFrontier, DomainLimiter interfaces\n\n## Validation\n- Types compile with no external dependencies in root package\n- make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:07:51.388967-08:00","updated_at":"2025-12-18T16:23:26.718308-08:00","closed_at":"2025-12-18T16:23:26.71831-08:00","dependencies":[{"issue_id":"locdoc-phn","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.41483-08:00","created_by":"daemon"}]}
{"id":"locdoc-sl6","title":"Add retry logic with exponential backoff for fetch failures","description":"## Problem\nTransient fetch failures (timeouts, network issues) cause permanent URL skips with no recovery.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - `processURL()` function\n\n## Validation\n- [ ] Fetch failures retry up to 3 times with 1s→2s→4s backoff\n- [ ] Only fetch stage retries (not extract/convert)\n- [ ] Retry attempts logged or visible in output\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T15:41:07.529599-08:00","updated_at":"2025-12-10T17:28:10.234925-08:00","closed_at":"2025-12-10T17:28:10.234928-08:00","dependencies":[{"issue_id":"locdoc-sl6","depends_on_id":"locdoc-57u","type":"blocks","created_at":"2025-12-10T15:41:22.655826-08:00","created_by":"daemon"}]}
{"id":"locdoc-t0c","title":"Implement CrawlProject in crawl package","description":"Move crawlProject() and processURL() logic from main.go to crawl/crawl.go as Crawler.CrawlProject method. Adapt to use ProgressFunc callback instead of direct stdout/stderr writes. Include helper functions (truncateURL, formatBytes, formatTokens, computeHash).","acceptance_criteria":"- [ ] Crawler.CrawlProject fully implemented\n- [ ] Uses ProgressFunc for all progress reporting\n- [ ] Helper functions moved to crawl package\n- [ ] crawl/crawl_test.go with tests using mock services\n- [ ] make validate passes","notes":"COMPLETED: All acceptance criteria met\n- Crawler.CrawlProject fully implemented with concurrent URL processing\n- Uses ProgressFunc for all progress reporting (Started, Completed, Failed, Finished events)\n- Helper functions (TruncateURL, FormatBytes, FormatTokens, ComputeHash) moved to crawl package and exported\n- crawl/crawl_test.go contains tests using mock services covering: empty URL list, single URL crawl, fetch failures, progress callbacks\n- main.go updated to use crawl package helper functions\n- make validate passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:45:03.653418-08:00","updated_at":"2025-12-11T19:13:40.619973-08:00","closed_at":"2025-12-11T19:13:40.619976-08:00","dependencies":[{"issue_id":"locdoc-t0c","depends_on_id":"locdoc-i7h","type":"parent-child","created_at":"2025-12-11T17:46:03.264703-08:00","created_by":"daemon"},{"issue_id":"locdoc-t0c","depends_on_id":"locdoc-fyy","type":"blocks","created_at":"2025-12-11T17:48:03.892026-08:00","created_by":"daemon"},{"issue_id":"locdoc-t0c","depends_on_id":"locdoc-a3x","type":"blocks","created_at":"2025-12-11T17:48:03.918979-08:00","created_by":"daemon"}]}
{"id":"locdoc-tsu","title":"Add filter column to projects table","description":"Add filter TEXT column to projects table schema. Update Project struct and SQLite implementation to read/write filter field.\n\n## Entrypoints\n- locdoc.go (Project struct)\n- sqlite/project.go\n- sqlite/schema.go\n\n## Validation\n- [ ] Project struct has Filter field\n- [ ] CreateProject/FindProjects handle filter\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:02.629597-08:00","updated_at":"2025-12-10T12:00:27.221029-08:00","closed_at":"2025-12-10T12:00:27.221034-08:00"}
{"id":"locdoc-v6q","title":"Strengthen rod integration test assertions","description":"Current integration tests only check for string presence (e.g., 'htmx' appears somewhere). This is weak - could pass even without JS rendering. Tests should verify actual rendered DOM structure.","acceptance_criteria":"- [ ] Tests verify HTML document structure (opening/closing tags)\n- [ ] Tests check for specific rendered content that requires JS execution\n- [ ] make validate passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T20:50:08.717091-08:00","updated_at":"2025-12-17T19:59:31.614169-08:00","closed_at":"2025-12-17T19:59:31.614172-08:00"}
{"id":"locdoc-wfk","title":"Implement cmd/locdoc/ CLI","description":"## Problem\n\nNeed CLI to wire all packages together and provide user interface.\n\n## Entrypoints\n\n- Create or update `cmd/locdoc/` directory\n- Wire all implementation packages\n\n## Requirements\n\n- `locdoc add \u003cname\u003e \u003curl\u003e` - register project with sitemap URL\n- `locdoc list` - show registered projects\n- `locdoc crawl [name]` - run full pipeline for all/one project\n- Wire: http/ → rod/ → trafilatura/ → htmltomd/ → sqlite/\n- Exit codes for success/failure\n- Progress output during crawl\n\n## Validation\n\n- [ ] End-to-end test: add project, crawl, verify documents stored\n- [ ] Test against real site (e.g., go.dev/doc/)\n- [ ] `make validate` passes\n- [ ] `CGO_ENABLED=0 go build` succeeds\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.997083-08:00","updated_at":"2025-12-09T14:25:54.728434-08:00","closed_at":"2025-12-09T14:25:54.728436-08:00","dependencies":[{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-mdd","type":"blocks","created_at":"2025-12-07T22:01:57.308742-08:00","created_by":"daemon"},{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-mtz","type":"blocks","created_at":"2025-12-07T22:01:57.334324-08:00","created_by":"daemon"},{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.057883-08:00","created_by":"daemon"}]}
{"id":"locdoc-x0w","title":"Centralize model name configuration in main","description":"## Problem\nModel name is currently defined in multiple places (gemini/asker.go, cmd/locdoc/main.go). Should be defined once in main and injected into components that need it.\n\n## Entrypoints\n- `cmd/locdoc/main.go` - define single model constant\n- `gemini/asker.go` - accept model as parameter to NewAsker\n- `gemini/token.go` - accept model as parameter to NewTokenCounter\n\n## Validation\n- [ ] Model name defined only in cmd/locdoc/main.go\n- [ ] Asker and TokenCounter accept model as constructor parameter\n- [ ] `make validate` passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T12:14:31.7888-08:00","updated_at":"2025-12-17T20:44:02.924121-08:00","closed_at":"2025-12-17T20:44:02.924124-08:00"}
{"id":"locdoc-ys8","title":"Implement link selector registry","description":"Create LinkSelectorRegistry that manages framework-specific selectors and auto-detects frameworks.\n\n## Entrypoints\n- Create goquery/registry.go - Registry struct with Get(), GetForHTML(), Register()\n- Create goquery/registry_test.go\n\n## Validation\n- Returns correct selector for each framework\n- Auto-detects framework from HTML\n- Falls back to generic selector for unknown frameworks\n- make validate passes","notes":"COMPLETED: LinkSelectorRegistry implementation with TDD\n\nCreated:\n- goquery/registry.go - Registry struct with Get(), GetForHTML(), Register(), List()\n- goquery/registry_test.go - 9 test cases covering all behaviors\n\nFeatures:\n- Returns correct selector for each framework via Get()\n- Auto-detects framework from HTML via GetForHTML()\n- Falls back to generic selector for unknown frameworks\n- Falls back when framework detected but no selector registered\n- Register() adds/overwrites selectors for frameworks\n- List() returns all registered frameworks\n\nAll tests pass, make validate passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T16:08:09.820916-08:00","updated_at":"2025-12-18T19:11:14.366435-08:00","closed_at":"2025-12-18T19:11:14.366438-08:00","dependencies":[{"issue_id":"locdoc-ys8","depends_on_id":"locdoc-2yj","type":"parent-child","created_at":"2025-12-18T16:16:39.800983-08:00","created_by":"daemon"},{"issue_id":"locdoc-ys8","depends_on_id":"locdoc-d6s","type":"blocks","created_at":"2025-12-18T16:18:25.005253-08:00","created_by":"daemon"},{"issue_id":"locdoc-ys8","depends_on_id":"locdoc-5lp","type":"blocks","created_at":"2025-12-18T16:18:25.069331-08:00","created_by":"daemon"}]}
{"id":"locdoc-zml","title":"XML document structure with metadata","description":"## Problem\nChange document serialization from markdown headers to XML format with index, title, source URL, and content per document.\n\n## Entrypoints\n- gemini/asker.go: buildPrompt function, create new formatDocumentsXML function\n\n## Validation\n- [ ] Documents wrapped in \u003cdocuments\u003e with individual \u003cdocument\u003e elements\n- [ ] Each document has index, title, source, content fields\n- [ ] Title falls back to source URL if empty\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T21:02:09.433362-08:00","updated_at":"2025-12-10T21:15:13.03919-08:00","closed_at":"2025-12-10T21:15:13.039192-08:00"}
{"id":"locdoc-zu7","title":"Review error messages for LLM-friendly guidance","description":"## Problem\n\nThis tool is designed for both humans and LLMs, with LLMs likely being the primary users. Error messages need to guide users toward correct usage, not just report failures.\n\n## Context\n\nGood CLI tools for LLM consumption follow a pattern: when something goes wrong, the error message explains:\n1. What failed\n2. Why it failed\n3. How to fix it\n\nExample of poor error: `invalid project`\nExample of good error: `project \"foo\" not found. Use \"locdoc list\" to see available projects.`\n\n## Entrypoints\n\n- `error.go` - existing error code infrastructure\n- `cmd/locdoc/*.go` - command implementations where errors surface\n\n## Work Required\n\n1. Audit all user-facing error paths\n2. Identify typical failure modes (wrong args, missing project, network issues, etc.)\n3. Ensure each error message includes actionable guidance\n4. Consider adding `--help` hints where appropriate\n\n## Validation\n\n- [ ] Each error path reviewed\n- [ ] Common failure modes have helpful messages\n- [ ] Messages tested with LLM to verify they guide toward correct usage\n- [ ] `make validate` passes","notes":"COMPLETED:\n- Audited all user-facing error paths\n- Improved error messages in add.go (regex filter), main.go (usage, database, browser, API key)\n- Added tests for regex filter, usage, and database errors\n\nIMPROVED MESSAGES:\n1. Invalid regex filter: now shows example patterns\n2. No command: now says 'locdoc --help' for help\n3. Database open: shows path and mentions LOCDOC_DB env var\n4. Browser start: mentions Chrome/Chromium requirement\n5. API key: improved to mention URL for getting key\n\nALREADY GOOD (unchanged):\n- Project not found errors (mention 'locdoc list')\n- No documents error (shows re-add instructions)\n- Delete without --force (clear guidance)\n- No projects message (mentions 'locdoc add')","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T15:59:26.347465-08:00","updated_at":"2025-12-12T07:52:54.793632-08:00","closed_at":"2025-12-12T07:52:54.793634-08:00"}
