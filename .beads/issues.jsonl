{"id":"locdoc-06y","title":"Remove unused RAG interfaces (ChunkService, SearchService)","description":"## Problem\n\nWe decided not to implement RAG initially, so the ChunkService and SearchService interfaces are unused and should be removed to reduce codebase complexity.\n\n## Entrypoints\n\n- `chunk.go` - contains all the types to remove\n\n## Work Required\n\nRemove the following from `chunk.go`:\n- `Chunk` struct\n- `ChunkMetadata` struct\n- `Chunk.Validate()` method\n- `ChunkService` interface\n- `ChunkFilter` struct\n- `SearchService` interface\n- `SearchOptions` struct\n- `SearchResult` struct\n\nIf the file becomes empty after removal, delete it entirely.\n\nAlso check `mock/` for any related mocks and remove them.\n\n## Validation\n\n- [ ] All RAG-related types removed from chunk.go\n- [ ] No orphaned mocks remain\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T20:16:34.374725-08:00","updated_at":"2025-12-09T20:23:38.153302-08:00","closed_at":"2025-12-09T20:23:38.153305-08:00"}
{"id":"locdoc-0fo","title":"Verify golangci-lint configuration alignment","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.010199-08:00","updated_at":"2025-12-07T17:52:59.10034-08:00","closed_at":"2025-12-07T17:52:59.100343-08:00","dependencies":[{"issue_id":"locdoc-0fo","depends_on_id":"locdoc-hw3","type":"blocks","created_at":"2025-12-07T16:40:55.276865-08:00","created_by":"daemon"}]}
{"id":"locdoc-0kg","title":"Filter sitemap URLs by source URL path prefix","description":"## Problem\n\nWhen adding a project with a path-specific URL like `https://htmx.org/docs/`, the sitemap discovery returns URLs for the entire site. This results in crawling unrelated pages (e.g., `/examples/`, `/essays/`) when the user only wanted `/docs/`.\n\n## Entrypoints\n\n- `http/sitemap.go` (SitemapService.DiscoverURLs)\n- `locdoc.go` (URLFilter struct)\n\n## Implementation\n\nWhen the source URL has a non-root path (e.g., `/docs/`), automatically filter sitemap results to only include URLs that start with that path prefix.\n\nExamples:\n- Source: `https://htmx.org/docs/` → only crawl URLs starting with `/docs/`\n- Source: `https://htmx.org/` → crawl all URLs (no filtering)\n- Source: `https://example.com/api/v2/` → only crawl URLs starting with `/api/v2/`\n\n## Validation\n\n- [ ] `locdoc add foo https://htmx.org/docs/` followed by `locdoc crawl foo` only fetches `/docs/*` pages\n- [ ] `locdoc add bar https://htmx.org/` crawls all pages (no filtering)\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:43:17.869922-08:00","updated_at":"2025-12-10T08:46:37.440774-08:00","closed_at":"2025-12-10T08:46:37.440777-08:00"}
{"id":"locdoc-1h6","title":"Create domain types skeleton","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:32.199767-08:00","updated_at":"2025-12-07T16:56:36.84987-08:00","closed_at":"2025-12-07T16:56:36.849873-08:00","dependencies":[{"issue_id":"locdoc-1h6","depends_on_id":"locdoc-knx","type":"blocks","created_at":"2025-12-07T16:40:59.902041-08:00","created_by":"daemon"}]}
{"id":"locdoc-1z8","title":"Create GitHub Actions CI workflow","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.10089-08:00","updated_at":"2025-12-07T18:08:02.712841-08:00","closed_at":"2025-12-07T18:08:02.712844-08:00","dependencies":[{"issue_id":"locdoc-1z8","depends_on_id":"locdoc-knx","type":"blocks","created_at":"2025-12-07T16:40:59.837864-08:00","created_by":"daemon"},{"issue_id":"locdoc-1z8","depends_on_id":"locdoc-0fo","type":"blocks","created_at":"2025-12-07T16:40:59.962233-08:00","created_by":"daemon"}]}
{"id":"locdoc-296","title":"Add Position field to Document domain type","description":"## Problem\n\nDocuments need a Position field to preserve sitemap order for coherent LLM context.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/document.go`\n\n## Implementation\n\nAdd `Position int` to `Document` struct (after ContentHash, before FetchedAt):\n```go\nPosition int `json:\"position\"`\n```\n\nAdd `Position *int` to `DocumentUpdate`:\n```go\nPosition *int `json:\"position\"`\n```\n\nAdd `SortBy string` to `DocumentFilter`:\n```go\nSortBy string `json:\"sortBy\"` // \"position\" or \"fetched_at\"\n```\n\n## Validation\n\n- [ ] Types compile\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:02.201376-08:00","updated_at":"2025-12-09T18:55:31.409109-08:00","closed_at":"2025-12-09T18:55:31.409112-08:00"}
{"id":"locdoc-2zl","title":"Integrate crawl logic into add command","description":"Move crawl functionality into the add command so add creates project AND crawls in one step.\n\n## Behavior\n- add \u003cname\u003e \u003curl\u003e creates project then immediately crawls\n- Remove hash-based diffing logic (always fresh crawl)\n- Errors if project already exists (without --force)\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd, crawlProject)\n\n## Validation\n- [ ] locdoc add \u003cname\u003e \u003curl\u003e creates and crawls\n- [ ] Error if project exists\n- [ ] No diffing logic (simpler code)\n- [ ] make validate passes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:23.718095-08:00","updated_at":"2025-12-10T11:06:23.718095-08:00","dependencies":[{"issue_id":"locdoc-2zl","depends_on_id":"locdoc-612","type":"blocks","created_at":"2025-12-10T11:06:44.505494-08:00","created_by":"daemon"}]}
{"id":"locdoc-4nk","title":"Implement gemini/ package","description":"## Problem\n\nNeed to implement the `Asker` interface using Google Gemini API.\n\n## Entrypoints\n\n- Create `gemini/gemini.go`\n\n## Implementation\n\n- Use `google.golang.org/genai` client\n- Read API key from `GEMINI_API_KEY` env var\n- Construct prompt from documents + question\n- Use `gemini-2.0-flash` model\n- Return plain text answer\n\n## Prompt Template\n\n```\nYou are a helpful assistant answering questions about software library documentation.\n\n\u003cdocumentation\u003e\n## Document: {title or source URL}\n{content}\n...\n\u003c/documentation\u003e\n\nQuestion: {question}\n\nAnswer based only on the documentation provided. If the answer is not in the documentation, say so.\n```\n\n## Validation\n\n- [ ] Package compiles\n- [ ] Mock added to `mock/` package\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:52.543185-08:00","updated_at":"2025-12-09T20:55:10.347225-08:00","closed_at":"2025-12-09T20:55:10.347229-08:00","dependencies":[{"issue_id":"locdoc-4nk","depends_on_id":"locdoc-amg","type":"blocks","created_at":"2025-12-09T16:29:04.564441-08:00","created_by":"daemon"}]}
{"id":"locdoc-4qp","title":"Update SQLite schema and implementation for Position","description":"## Problem\n\nSQLite needs position column and queries need to handle it.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/sqlite/sqlite.go` - schema\n- `/Users/filip/code/go/locdoc/sqlite/document.go` - queries\n\n## Implementation\n\n**Schema** - add column to documents table:\n```sql\nposition INTEGER NOT NULL DEFAULT 0\n```\n\n**CreateDocument** - include position in INSERT\n\n**FindDocumentByID** - include position in SELECT and Scan\n\n**FindDocuments** - include position in SELECT/Scan, respect SortBy:\n```go\nswitch filter.SortBy {\ncase \"position\":\n    query.WriteString(\" ORDER BY position ASC\")\ndefault:\n    query.WriteString(\" ORDER BY fetched_at DESC\")\n}\n```\n\n**UpdateDocument** - handle Position in update\n\n## Validation\n\n- [ ] Schema includes position column\n- [ ] All queries handle position\n- [ ] SortBy respected in FindDocuments\n- [ ] Existing tests pass\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:08.935564-08:00","updated_at":"2025-12-09T19:01:18.324679-08:00","closed_at":"2025-12-09T19:01:18.324681-08:00","dependencies":[{"issue_id":"locdoc-4qp","depends_on_id":"locdoc-296","type":"blocks","created_at":"2025-12-09T17:57:42.54959-08:00","created_by":"daemon"}]}
{"id":"locdoc-4se","title":"Update ask command design document for ordering","description":"## Problem\n\nThe ask command design document should mention document ordering.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/docs/plans/2025-12-09-ask-command-design.md`\n\n## Changes\n\nUpdate the design doc to note:\n- Documents are fetched in sitemap position order\n- This provides coherent LLM context (getting started before advanced topics)\n- Use `SortBy: \"position\"` when fetching documents for ask command\n\n## Validation\n\n- [ ] Design doc updated\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:32.523577-08:00","updated_at":"2025-12-09T18:52:24.414431-08:00","closed_at":"2025-12-09T18:52:24.414434-08:00"}
{"id":"locdoc-56t","title":"Add locdoc delete command","description":"## Problem\n\nNeed CLI command to delete projects.\n\n## Entrypoints\n\n- `cmd/locdoc/main.go` - Add delete command dispatch\n- Interface and sqlite implementation already exist (`ProjectService.DeleteProject`)\n\n## Requirements\n\n- `locdoc delete \u003cname\u003e` - delete project by name\n- Confirm before deleting (or add --force flag)\n- Cascade deletes associated documents (handled by sqlite foreign keys)\n\n## Validation\n\n- [ ] Unit tests for cmdDelete\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T14:25:01.662287-08:00","updated_at":"2025-12-09T15:05:18.77442-08:00","closed_at":"2025-12-09T15:05:18.774424-08:00"}
{"id":"locdoc-5ma","title":"Add bounded concurrency to crawl command","description":"## Problem\n\nCrawling is slow because URLs are fetched sequentially. With 179 URLs, this takes several minutes.\n\n## Entrypoints\n\n- cmd/locdoc/main.go (crawlProject function)\n\n## Implementation\n\nAdd bounded concurrency (e.g., 5-10 workers) while preserving document position ordering:\n1. Create a worker pool with semaphore\n2. Process URLs concurrently\n3. Collect results with their original position index\n4. Store documents with correct position values\n\nConsider using errgroup with SetLimit() for bounded concurrency.\n\n## Validation\n\n- [ ] Crawl is noticeably faster\n- [ ] Document positions are preserved correctly\n- [ ] Error handling still works (skip failed URLs)\n- [ ] make validate passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T20:57:11.594455-08:00","updated_at":"2025-12-09T21:30:15.160985-08:00","closed_at":"2025-12-09T21:30:15.160989-08:00"}
{"id":"locdoc-612","title":"Add --preview flag to add command","description":"Add --preview flag that shows sitemap URLs without creating project or crawling.\n\n## Behavior\n- Discovers URLs from sitemap\n- Prints URL list to stdout\n- Does NOT create project record\n- Does NOT crawl\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n\n## Validation\n- [ ] locdoc add foo http://example.com --preview shows URLs\n- [ ] No project created with --preview\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:11.515317-08:00","updated_at":"2025-12-10T12:15:44.829601-08:00","closed_at":"2025-12-10T12:15:44.829605-08:00"}
{"id":"locdoc-6ph","title":"Expand docs/ with workflow documentation","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.388874-08:00","updated_at":"2025-12-07T20:25:33.186919-08:00","closed_at":"2025-12-07T20:25:33.186923-08:00","dependencies":[{"issue_id":"locdoc-6ph","depends_on_id":"locdoc-hw3","type":"blocks","created_at":"2025-12-07T16:40:59.769594-08:00","created_by":"daemon"}]}
{"id":"locdoc-726","title":"Epic: Combine add and crawl commands","description":"Merge the two-step add/crawl flow into a single add command. Remove diffing logic in favor of simpler delete + recreate pattern. Add --force, --preview, and --filter flags.\n\nDesign doc: docs/plans/2025-12-10-combine-add-crawl-design.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T11:05:47.835912-08:00","updated_at":"2025-12-10T11:05:55.116255-08:00"}
{"id":"locdoc-7n8","title":"Improve beads metadata workflow to avoid mixing with feature PRs","description":"## Problem\nWhen using `bd update` to mark tasks closed, the `.beads/issues.jsonl` change ends up in the working tree and can accidentally get included in feature PR commits. This causes PR review tools (like GitHub Copilot) to flag unintended changes.\n\n## Potential solutions\n- Commit beads changes separately before the feature commit\n- Add `.gitattributes` to mark `.beads/` as not needing review\n- Script the \"land this plane\" flow to handle beads commits first\n- Investigate if beads protected_branches config can help more","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:15:48.914404-08:00","updated_at":"2025-12-07T19:55:47.046488-08:00","closed_at":"2025-12-07T19:55:47.04649-08:00"}
{"id":"locdoc-7x3","title":"Consider SQLite WAL mode for write-heavy operations","description":"## Problem\n\nSQLite WAL (Write-Ahead Logging) mode can improve performance for write-heavy operations like crawling. Currently using default rollback journal.\n\n## Entrypoints\n\n- `sqlite/sqlite.go` - `Open()` method\n\n## Analysis Needed\n\n- Benchmark crawl performance with/without WAL\n- Consider trade-offs:\n  - WAL creates extra files (`-wal`, `-shm`) alongside database\n  - Better for concurrent access (less relevant for CLI)\n  - Better crash recovery\n  - Files must be checkpointed before moving database\n\n## References\n\n- https://github.com/benbjohnson/wtf/blob/main/sqlite/sqlite.go\n- https://sqlite.org/wal.html\n\n## Validation\n\n- [ ] Benchmark shows measurable improvement\n- [ ] Document decision either way","notes":"Implemented WAL mode. Benchmarks showed ~7x improvement for single inserts (51µs vs 344µs) and ~6.7x for bulk inserts (4.4ms vs 29ms for 100 docs). Also reduced memory allocations by ~20x per operation.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T13:20:05.747214-08:00","updated_at":"2025-12-09T19:23:57.450621-08:00","closed_at":"2025-12-09T19:23:57.450626-08:00"}
{"id":"locdoc-9f6","title":"Add --filter flag to add command","description":"## Problem\nAdd --filter flag to add command that filters which URLs get crawled from the sitemap.\n\n## Requirements\n- **Regex patterns** (industry standard, already used in URLFilter)\n- **Multiple patterns via repeated flags**: `--filter \"docs\" --filter \"blog\"`\n- Patterns are OR'd together (URL passes if it matches ANY pattern)\n- Stored as newline-separated string in Project.Filter field\n- Converted to URLFilter.Include patterns at runtime\n\n## Implementation\n1. **Refactor first**: Extract CmdAdd flag parsing into `addOptions` struct + `parseAddArgs` function\n2. Add --filter to the options struct ([]string for multiple values)\n3. Pass filters to DiscoverURLs in preview mode\n4. Store filters on project creation\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n- locdoc.go (URLFilter already exists)\n\n## Validation\n- [ ] CmdAdd uses addOptions struct for clean parsing\n- [ ] --filter accepts regex pattern and stores on project\n- [ ] Multiple --filter flags can be specified\n- [ ] --preview --filter shows only matching URLs  \n- [ ] Crawl only fetches URLs matching at least one pattern\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:17.781395-08:00","updated_at":"2025-12-10T12:43:23.602359-08:00","closed_at":"2025-12-10T12:43:23.602361-08:00","dependencies":[{"issue_id":"locdoc-9f6","depends_on_id":"locdoc-tsu","type":"blocks","created_at":"2025-12-10T11:06:44.437565-08:00","created_by":"daemon"}]}
{"id":"locdoc-9h9","title":"Add DocumentFormatter to root package","description":"## Problem\n\nNeed a shared component to format documents for display and LLM context.\n\n## Entrypoints\n\n- Create new file `formatter.go` in root package\n\n## Implementation\n\n```go\n// DocumentFormatter formats documents for display or LLM context.\ntype DocumentFormatter interface {\n    Format(docs []*Document) string\n}\n```\n\nOr simpler, just a function type / concrete implementation.\n\nOutput format:\n```\n## Document: {title or source URL}\n{content}\n\n## Document: {title or source URL}\n{content}\n```\n\n- Use title if available, fall back to source URL\n- Documents separated by blank lines\n- Preserve markdown content as-is\n\n## Usage\n\n- `locdoc docs` prints this to stdout\n- `locdoc ask` wraps this in prompt template for Gemini\n\n## Validation\n\n- [ ] Formatter defined\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T18:00:37.792739-08:00","updated_at":"2025-12-09T19:44:53.984031-08:00","closed_at":"2025-12-09T19:44:53.984035-08:00","dependencies":[{"issue_id":"locdoc-9h9","depends_on_id":"locdoc-296","type":"blocks","created_at":"2025-12-09T18:00:42.552411-08:00","created_by":"daemon"}]}
{"id":"locdoc-a3y","title":"Epic: Documentation Crawler MVP","description":"## Overview\n\nImplement pure Go documentation crawler as defined in docs/plans/2025-12-07-crawling-design.md.\n\n## Scope\n\n- Sitemap-based URL discovery\n- Browser-based page fetching (JS rendering)\n- Content extraction and markdown conversion\n- SQLite storage\n\n## Success Criteria\n\n- `locdoc add \u003cname\u003e \u003curl\u003e` registers project\n- `locdoc crawl [name]` fetches pages from sitemap, stores as Markdown\n- `make validate` passes\n- Builds with `CGO_ENABLED=0`\n\n## Implementation Order\n\n1. sqlite/ - Storage foundation\n2. http/ - Sitemap parsing\n3. rod/ - Browser fetching\n4. trafilatura/ - Content extraction\n5. htmltomd/ - Markdown conversion\n6. cmd/locdoc/ - CLI wiring","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:00:37.291952-08:00","updated_at":"2025-12-09T14:26:04.271553-08:00","closed_at":"2025-12-09T14:26:04.271555-08:00"}
{"id":"locdoc-a4x","title":"Implement rod/ package","description":"## Problem\n\nNeed browser-based page fetching for JS-rendered documentation sites.\n\n## Entrypoints\n\n- Create `rod/` directory\n- Implement fetcher that returns rendered HTML\n\n## Requirements\n\n- Use `go-rod/rod` for Chrome automation\n- Launch Chrome or connect to existing instance\n- Navigate to URL, wait for JS to render\n- Return rendered HTML as string\n- Handle timeouts gracefully\n- Clean up browser resources on shutdown\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with mock browser (if feasible)\n- [ ] Integration test against real JS-heavy site\n- [ ] Verify Chrome requirement is documented\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- go-rod/rod documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.611936-08:00","updated_at":"2025-12-09T04:54:24.256482-08:00","closed_at":"2025-12-09T04:54:24.256485-08:00","dependencies":[{"issue_id":"locdoc-a4x","depends_on_id":"locdoc-k4l","type":"blocks","created_at":"2025-12-07T22:01:57.221765-08:00","created_by":"daemon"},{"issue_id":"locdoc-a4x","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.977866-08:00","created_by":"daemon"}]}
{"id":"locdoc-a7o","title":"Add --help flag to CLI","description":"## Problem\n\nCLI does not support --help or -h flags. Running 'locdoc --help' returns 'unknown command' error.\n\n## Entrypoints\n\n- cmd/locdoc/main.go\n\n## Implementation\n\nAdd case for 'help', '--help', '-h' in command switch that calls usage() without returning an error.\n\n## Validation\n\n- [ ] locdoc --help shows usage\n- [ ] locdoc -h shows usage\n- [ ] locdoc help shows usage\n- [ ] make validate passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T20:55:14.222704-08:00","updated_at":"2025-12-09T21:17:13.935164-08:00","closed_at":"2025-12-09T21:17:13.935168-08:00"}
{"id":"locdoc-amg","title":"Add Asker interface to root package","description":"## Problem\n\nNeed a domain interface for asking natural language questions about documentation.\n\n## Entrypoints\n\n- Create new file `asker.go` in root package\n\n## Implementation\n\n```go\n// Asker provides natural language question answering over documentation.\ntype Asker interface {\n    Ask(ctx context.Context, projectID string, question string) (string, error)\n}\n```\n\n## Validation\n\n- [ ] Interface defined in root package\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:46.880379-08:00","updated_at":"2025-12-09T20:26:16.589741-08:00","closed_at":"2025-12-09T20:26:16.589744-08:00"}
{"id":"locdoc-bxd","title":"Add mock implementation docs to go-standard-package-layout skill","description":"## Problem\n\nThe go-standard-package-layout skill doesn't document how to implement mocks following Ben Johnson's pattern.\n\n## Entrypoints\n\n- `/Users/filip/.claude/skills/go-standard-package-layout/go-standard-package-layout.md`\n\n## Requirements\n\nAdd a section on mock implementation patterns:\n- One file per entity in mock/ package (e.g., mock/user.go, mock/project.go)\n- Function fields pattern for dependency injection\n- Compile-time interface verification\n- Example from wtf repo\n\n## Validation\n\n- [ ] Skill file updated with mock section\n- [ ] Examples included","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T14:25:34.540459-08:00","updated_at":"2025-12-09T14:50:18.181082-08:00","closed_at":"2025-12-09T14:50:18.181087-08:00"}
{"id":"locdoc-c4s","title":"Create mock package skeleton","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.293012-08:00","updated_at":"2025-12-07T19:12:29.650324-08:00","closed_at":"2025-12-07T19:12:29.650327-08:00","dependencies":[{"issue_id":"locdoc-c4s","depends_on_id":"locdoc-1h6","type":"blocks","created_at":"2025-12-07T16:41:00.022992-08:00","created_by":"daemon"}]}
{"id":"locdoc-co5","title":"Add --force flag to add command","description":"Add --force flag that deletes existing project before creating new one.\n\n## Behavior\n- Without --force: error if project exists\n- With --force: delete existing project + docs, then create + crawl\n- Enables re-crawling via delete + recreate pattern\n\n## Entrypoints\n- cmd/locdoc/main.go (CmdAdd)\n\n## Validation\n- [ ] --force deletes existing and recreates\n- [ ] Without --force, error on existing project\n- [ ] make validate passes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:29.922497-08:00","updated_at":"2025-12-10T11:06:29.922497-08:00","dependencies":[{"issue_id":"locdoc-co5","depends_on_id":"locdoc-2zl","type":"blocks","created_at":"2025-12-10T11:06:44.573399-08:00","created_by":"daemon"}]}
{"id":"locdoc-ecb","title":"Epic: Ask Command","description":"## Overview\n\nImplement the `locdoc ask \u003cproject\u003e \"question\"` command that queries documentation using Gemini Flash.\n\n## Design\n\nSee docs/plans/2025-12-09-ask-command-design.md\n\n## Scope\n\n- Add `Asker` interface to root package\n- Implement `gemini/` package wrapping Gemini API\n- Add `CmdAsk` to CLI\n- LLM-friendly error messages\n\n## Validation\n\n- [ ] `locdoc ask \u003cproject\u003e \"question\"` returns useful answers\n- [ ] Error messages guide users to correct usage\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:42.085842-08:00","updated_at":"2025-12-09T21:27:11.834105-08:00","closed_at":"2025-12-09T21:27:11.83411-08:00","dependencies":[{"issue_id":"locdoc-ecb","depends_on_id":"locdoc-il8","type":"blocks","created_at":"2025-12-09T16:29:04.693172-08:00","created_by":"daemon"}]}
{"id":"locdoc-gc0","title":"Implement trafilatura/ package","description":"## Problem\n\nNeed content extraction to remove boilerplate from crawled pages.\n\n## Entrypoints\n\n- Create `trafilatura/` directory\n- Wrap go-trafilatura library API\n\n## Requirements\n\n- Accept raw HTML string\n- Return clean HTML + title (metadata)\n- Remove boilerplate (nav, footer, sidebar, ads)\n- Preserve main content structure\n- Use go-trafilatura library (not CLI)\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with HTML fixtures\n- [ ] Test against various doc site formats (Docusaurus, MkDocs, etc.)\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/markusmobius/go-trafilatura examples/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.742322-08:00","updated_at":"2025-12-09T12:04:36.268301-08:00","closed_at":"2025-12-09T12:04:36.268308-08:00","dependencies":[{"issue_id":"locdoc-gc0","depends_on_id":"locdoc-a4x","type":"blocks","created_at":"2025-12-07T22:01:57.250498-08:00","created_by":"daemon"},{"issue_id":"locdoc-gc0","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.004233-08:00","created_by":"daemon"}]}
{"id":"locdoc-glt","title":"Path prefix filter not matching URLs without trailing slash","description":"## Resolution\n\n**Not a bug** - htmx.org's sitemap genuinely only contains 1 URL under `/docs/`:\n\n```\nPath breakdown (179 total URLs):\n49 /essays/\n36 /posts/\n36 /attributes/\n30 /examples/\n 9 /extensions/\n 7 /headers/\n 1 /docs/        ← Only this one!\n 1 /api/\n 1 /reference/\n```\n\nhtmx.org organizes documentation under `/attributes/`, `/api/`, `/reference/`, etc. - NOT under `/docs/`. The `/docs/` page is just a landing page.\n\n**The path prefix filtering works correctly.** To crawl htmx docs, use `https://htmx.org/` (no path filter) or target specific paths like `/attributes/`.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T07:55:47.487493-08:00","updated_at":"2025-12-10T07:57:30.738468-08:00","closed_at":"2025-12-10T07:57:30.738472-08:00"}
{"id":"locdoc-h4h","title":"Add locdoc docs command","description":"## Problem\n\nNeed a way to inspect stored documents for a project.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/cmd/locdoc/main.go`\n\n## Implementation\n\n1. Add to usage():\n```\ndocs \u003cname\u003e [--full]   List documents for a project (--full for content)\n```\n\n2. Add case to Run() switch\n\n3. Implement CmdDocs()\n\n### Default mode: `locdoc docs \u003cproject\u003e`\n\nSummary listing:\n```\nDocuments for inngest (42 total):\n\n  1. Getting Started\n     https://inngest.com/docs/getting-started\n  2. Functions\n     https://inngest.com/docs/functions\n```\n\n### Full mode: `locdoc docs \u003cproject\u003e --full`\n\nFull formatted content (same as what ask sends to Gemini):\n```\n## Document: Getting Started\n{full markdown content}\n\n## Document: Functions\n{full markdown content}\n```\n\nUses DocumentFormatter for full output.\n\n### Error messages\n\n- Project not found: `project \"foo\" not found. Use \"locdoc list\" to see available projects.`\n- No documents: `project \"foo\" has no documents. Run \"locdoc crawl foo\" first.`\n\n## Validation\n\n- [ ] `locdoc docs \u003cproject\u003e` shows summary listing\n- [ ] `locdoc docs \u003cproject\u003e --full` shows full content\n- [ ] Full output matches what ask command sends to LLM\n- [ ] Error messages are helpful\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:23.564894-08:00","updated_at":"2025-12-09T20:01:24.57742-08:00","closed_at":"2025-12-09T20:01:24.577423-08:00","dependencies":[{"issue_id":"locdoc-h4h","depends_on_id":"locdoc-4qp","type":"blocks","created_at":"2025-12-09T17:57:42.690932-08:00","created_by":"daemon"},{"issue_id":"locdoc-h4h","depends_on_id":"locdoc-9h9","type":"blocks","created_at":"2025-12-09T18:00:42.576965-08:00","created_by":"daemon"}]}
{"id":"locdoc-hhk","title":"Add SQLite connection pool and busy timeout settings","description":"## Problem\n\nSQLite has connection pool and timeout settings that can prevent \"database is locked\" errors and improve robustness.\n\n## Entrypoints\n\n- `sqlite/sqlite.go` - `Open()` method\n\n## Suggested Settings\n\nFrom Ben Johnson's WTF:\n- `db.SetMaxOpenConns(1)` - SQLite only supports one writer anyway\n- `PRAGMA busy_timeout = 5000` - Wait 5s instead of failing immediately on lock\n\n## References\n\n- https://github.com/benbjohnson/wtf/blob/main/sqlite/sqlite.go\n\n## Validation\n\n- [ ] Settings applied in `Open()`\n- [ ] `make validate` passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T13:20:05.81999-08:00","updated_at":"2025-12-09T19:37:05.779579-08:00","closed_at":"2025-12-09T19:37:05.779582-08:00"}
{"id":"locdoc-hw3","title":"Create CLAUDE.md with AI agent instructions","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:31.845746-08:00","updated_at":"2025-12-07T16:51:04.766651-08:00","closed_at":"2025-12-07T16:51:04.766654-08:00"}
{"id":"locdoc-il8","title":"Implement CmdAsk in CLI","description":"## Problem\n\nNeed CLI command to ask questions about project documentation.\n\n## Entrypoints\n\n- `cmd/locdoc/main.go`\n\n## Implementation\n\nAdd `CmdAsk` function that:\n1. Parses args: `locdoc ask \u003cproject\u003e \"question\"`\n2. Looks up project by name\n3. Fetches all documents for project\n4. Validates project has documents\n5. Calls `Asker.Ask()`\n6. Prints result to stdout\n\n## Error Messages\n\nProject not found:\n```\nproject \"foo\" not found. Use \"locdoc list\" to see available projects, or \"locdoc add \u003cname\u003e \u003curl\u003e\" to add one.\n```\n\nNo documents:\n```\nproject \"foo\" has no documents. Run \"locdoc crawl foo\" to fetch documentation first.\n```\n\nMissing API key:\n```\nGEMINI_API_KEY environment variable not set. Get an API key at https://aistudio.google.com/apikey\n```\n\n## Validation\n\n- [ ] `locdoc ask` with wrong args shows usage\n- [ ] Missing project shows helpful error\n- [ ] Empty project shows helpful error\n- [ ] Missing API key shows helpful error\n- [ ] Valid query returns answer\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T16:28:59.19651-08:00","updated_at":"2025-12-09T21:03:30.728479-08:00","closed_at":"2025-12-09T21:03:30.728482-08:00","dependencies":[{"issue_id":"locdoc-il8","depends_on_id":"locdoc-4nk","type":"blocks","created_at":"2025-12-09T16:29:04.632737-08:00","created_by":"daemon"},{"issue_id":"locdoc-il8","depends_on_id":"locdoc-n3w","type":"blocks","created_at":"2025-12-09T17:57:42.761146-08:00","created_by":"daemon"},{"issue_id":"locdoc-il8","depends_on_id":"locdoc-9h9","type":"blocks","created_at":"2025-12-09T18:00:42.600797-08:00","created_by":"daemon"}]}
{"id":"locdoc-k4l","title":"Implement sqlite/ package","description":"## Problem\n\nNeed SQLite storage layer using pure Go driver (no CGO).\n\n## Entrypoints\n\n- Create `sqlite/` directory\n- Implement `ProjectService` interface from project.go\n- Implement `DocumentService` interface from document.go\n\n## Requirements\n\n- Use `ncruces/go-sqlite3` with `database/sql` driver\n- Auto-create schema on first run (migrations)\n- Store document content as Markdown text\n- Content hash (xxHash) for change detection\n- Compile-time interface verification: `var _ locdoc.ProjectService = (*ProjectService)(nil)`\n\n## Validation\n\n- [ ] Unit tests for CRUD operations\n- [ ] Integration test with real SQLite file\n- [ ] `make validate` passes\n- [ ] Builds with `CGO_ENABLED=0`\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:00:47.279328-08:00","updated_at":"2025-12-08T12:37:13.040666-08:00","closed_at":"2025-12-08T12:37:13.04067-08:00","dependencies":[{"issue_id":"locdoc-k4l","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.920979-08:00","created_by":"daemon"}]}
{"id":"locdoc-knx","title":"Create Makefile with validate target","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:40:31.93188-08:00","updated_at":"2025-12-07T16:52:33.128539-08:00","closed_at":"2025-12-07T16:52:33.128541-08:00"}
{"id":"locdoc-l52","title":"Improve crawl command output with summary statistics","description":"## Problem\n\nAfter making crawl concurrent, the output now dumps as a wall of text at the end instead of streaming progress. The verbose per-URL output isn't useful when it all appears at once.\n\n## Design\n\nSee [docs/plans/2025-12-10-crawl-summary-token-counting.md](../docs/plans/2025-12-10-crawl-summary-token-counting.md)\n\n**Summary:**\n- Add `TokenCounter` interface to root package\n- Implement in `gemini/` package using `google.golang.org/genai/tokenizer`\n- Model const (`gemini-2.5-flash`) in main, passed to tokenizer\n- Count tokens during crawl results loop, accumulate totals\n- Replace per-URL output with summary: `Saved 179 pages (2.3 MB, ~580k tokens)`\n\n## Entrypoints\n\n- `locdoc.go` - Add TokenCounter interface\n- `gemini/token.go` - New implementation\n- `mock/token.go` - New mock\n- `cmd/locdoc/main.go` - Wire tokenizer, update crawlProject output\n\n## Validation\n\n- [ ] Crawl shows summary instead of per-URL output\n- [ ] Summary includes page count, size, and token count\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T08:00:39.134594-08:00","updated_at":"2025-12-10T09:26:21.02203-08:00","closed_at":"2025-12-10T09:26:21.022032-08:00"}
{"id":"locdoc-mdd","title":"Implement htmltomd/ package","description":"## Problem\n\nNeed HTML to Markdown conversion for storage.\n\n## Entrypoints\n\n- Create `htmltomarkdown/` directory\n- Wrap html-to-markdown library\n\n## Requirements\n\n- Accept clean HTML string\n- Return Markdown string\n- Preserve code blocks with language hints\n- Preserve tables, links, headings\n- Use `JohannesKaufmann/html-to-markdown` library\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with HTML fixtures\n- [ ] Test code block preservation\n- [ ] Test table conversion\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/JohannesKaufmann/html-to-markdown","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.868426-08:00","updated_at":"2025-12-09T12:24:43.88477-08:00","closed_at":"2025-12-09T12:24:43.884774-08:00","dependencies":[{"issue_id":"locdoc-mdd","depends_on_id":"locdoc-gc0","type":"blocks","created_at":"2025-12-07T22:01:57.281633-08:00","created_by":"daemon"},{"issue_id":"locdoc-mdd","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.032944-08:00","created_by":"daemon"}]}
{"id":"locdoc-mtz","title":"Implement http/ package","description":"## Problem\n\nNeed sitemap discovery and parsing for URL extraction.\n\n## Entrypoints\n\n- Create `http/` directory\n- Port sitemap logic from go-trafilatura cmd/\n\n## Requirements\n\n- Discover sitemap URL from robots.txt (`Sitemap:` directive)\n- Fall back to `/sitemap.xml` if not found\n- Parse sitemap XML using `beevik/etree`\n- Handle sitemap indexes recursively\n- Filter URLs by pattern (include/exclude regex)\n- Return list of discovered URLs\n- Respect context cancellation\n- Define interface in root package during implementation\n\n## Validation\n\n- [ ] Unit tests with sitemap XML fixtures\n- [ ] Integration test against real site (e.g., go.dev)\n- [ ] `make validate` passes\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md\n- github.com/markusmobius/go-trafilatura/cmd/go-trafilatura/sitemap.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.476838-08:00","updated_at":"2025-12-08T13:38:49.035033-08:00","closed_at":"2025-12-08T13:38:49.035037-08:00","dependencies":[{"issue_id":"locdoc-mtz","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:04.951025-08:00","created_by":"daemon"}]}
{"id":"locdoc-n3w","title":"Capture sitemap position during crawl","description":"## Problem\n\ncrawlProject() has the loop index but does not store it as document position.\n\n## Entrypoints\n\n- `/Users/filip/code/go/locdoc/cmd/locdoc/main.go` - crawlProject()\n\n## Implementation\n\n1. Set Position when creating document:\n```go\ndoc := \u0026locdoc.Document{\n    // ... existing fields ...\n    Position: i,\n}\n```\n\n2. Include position when updating:\n```go\nposition := i\ndocuments.UpdateDocument(ctx, existing.ID, locdoc.DocumentUpdate{\n    // ... existing fields ...\n    Position: \u0026position,\n})\n```\n\n3. Update position even when content unchanged:\n```go\nif existing != nil \u0026\u0026 existing.ContentHash == hash {\n    if existing.Position != i {\n        position := i\n        documents.UpdateDocument(ctx, existing.ID, locdoc.DocumentUpdate{\n            Position: \u0026position,\n        })\n        fmt.Fprintln(stdout, \"    position updated\")\n    } else {\n        fmt.Fprintln(stdout, \"    unchanged\")\n    }\n    continue\n}\n```\n\n## Validation\n\n- [ ] New documents get correct position\n- [ ] Updated documents get correct position\n- [ ] Position updates when content unchanged but position changed\n- [ ] `make validate` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T17:57:16.281017-08:00","updated_at":"2025-12-09T19:14:08.609013-08:00","closed_at":"2025-12-09T19:14:08.609016-08:00","dependencies":[{"issue_id":"locdoc-n3w","depends_on_id":"locdoc-4qp","type":"blocks","created_at":"2025-12-09T17:57:42.619239-08:00","created_by":"daemon"}]}
{"id":"locdoc-nnd","title":"Create .claude/ commands","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:40:32.484792-08:00","updated_at":"2025-12-07T20:31:12.324995-08:00","closed_at":"2025-12-07T20:31:12.324998-08:00"}
{"id":"locdoc-ot9","title":"Remove crawl command","description":"Remove the standalone crawl command now that add handles crawling.\n\n## Changes\n- Remove CmdCrawl function\n- Remove crawl case from command dispatch\n- Update help text\n- Update any docs referencing crawl\n\n## Entrypoints\n- cmd/locdoc/main.go\n\n## Validation\n- [ ] crawl command removed\n- [ ] Help text updated\n- [ ] make validate passes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:35.912545-08:00","updated_at":"2025-12-10T11:06:35.912545-08:00","dependencies":[{"issue_id":"locdoc-ot9","depends_on_id":"locdoc-co5","type":"blocks","created_at":"2025-12-10T11:06:44.640437-08:00","created_by":"daemon"},{"issue_id":"locdoc-ot9","depends_on_id":"locdoc-9f6","type":"blocks","created_at":"2025-12-10T11:06:44.70731-08:00","created_by":"daemon"}]}
{"id":"locdoc-tsu","title":"Add filter column to projects table","description":"Add filter TEXT column to projects table schema. Update Project struct and SQLite implementation to read/write filter field.\n\n## Entrypoints\n- locdoc.go (Project struct)\n- sqlite/project.go\n- sqlite/schema.go\n\n## Validation\n- [ ] Project struct has Filter field\n- [ ] CreateProject/FindProjects handle filter\n- [ ] make validate passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:06:02.629597-08:00","updated_at":"2025-12-10T12:00:27.221029-08:00","closed_at":"2025-12-10T12:00:27.221034-08:00"}
{"id":"locdoc-wfk","title":"Implement cmd/locdoc/ CLI","description":"## Problem\n\nNeed CLI to wire all packages together and provide user interface.\n\n## Entrypoints\n\n- Create or update `cmd/locdoc/` directory\n- Wire all implementation packages\n\n## Requirements\n\n- `locdoc add \u003cname\u003e \u003curl\u003e` - register project with sitemap URL\n- `locdoc list` - show registered projects\n- `locdoc crawl [name]` - run full pipeline for all/one project\n- Wire: http/ → rod/ → trafilatura/ → htmltomd/ → sqlite/\n- Exit codes for success/failure\n- Progress output during crawl\n\n## Validation\n\n- [ ] End-to-end test: add project, crawl, verify documents stored\n- [ ] Test against real site (e.g., go.dev/doc/)\n- [ ] `make validate` passes\n- [ ] `CGO_ENABLED=0 go build` succeeds\n\n## References\n\n- docs/plans/2025-12-07-crawling-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:01:24.997083-08:00","updated_at":"2025-12-09T14:25:54.728434-08:00","closed_at":"2025-12-09T14:25:54.728436-08:00","dependencies":[{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-mdd","type":"blocks","created_at":"2025-12-07T22:01:57.308742-08:00","created_by":"daemon"},{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-mtz","type":"blocks","created_at":"2025-12-07T22:01:57.334324-08:00","created_by":"daemon"},{"issue_id":"locdoc-wfk","depends_on_id":"locdoc-a3y","type":"parent-child","created_at":"2025-12-07T22:02:05.057883-08:00","created_by":"daemon"}]}
{"id":"locdoc-zu7","title":"Review error messages for LLM-friendly guidance","description":"## Problem\n\nThis tool is designed for both humans and LLMs, with LLMs likely being the primary users. Error messages need to guide users toward correct usage, not just report failures.\n\n## Context\n\nGood CLI tools for LLM consumption follow a pattern: when something goes wrong, the error message explains:\n1. What failed\n2. Why it failed\n3. How to fix it\n\nExample of poor error: `invalid project`\nExample of good error: `project \"foo\" not found. Use \"locdoc list\" to see available projects.`\n\n## Entrypoints\n\n- `error.go` - existing error code infrastructure\n- `cmd/locdoc/*.go` - command implementations where errors surface\n\n## Work Required\n\n1. Audit all user-facing error paths\n2. Identify typical failure modes (wrong args, missing project, network issues, etc.)\n3. Ensure each error message includes actionable guidance\n4. Consider adding `--help` hints where appropriate\n\n## Validation\n\n- [ ] Each error path reviewed\n- [ ] Common failure modes have helpful messages\n- [ ] Messages tested with LLM to verify they guide toward correct usage\n- [ ] `make validate` passes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T15:59:26.347465-08:00","updated_at":"2025-12-09T15:59:26.347465-08:00"}
